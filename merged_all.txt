
--- START: FrontEnd/Dockerfile ---
FROM node:20-alpine AS build
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build
EXPOSE 5173

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
# End of Dockerfile
--- END: FrontEnd/Dockerfile ---

--- START: FrontEnd/deploy_frontend.sh ---
#!/usr/bin/env bash
set -euo pipefail

# ==== CONFIG ====
AWS_REGION="us-east-1"
NAMESPACE="devsecjobs"
DEPLOYMENT="frontend-deployment"
CONTAINER_NAME="frontend"
REPO_NAME="devsecjobs-frontend"
ACCOUNT_ID="455715798206"
ECR_URI="${ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com/${REPO_NAME}"

# ==== INPUT TAG ====
TAG="${1:-}"
if [[ -z "${TAG}" ]]; then
  TAG="v$(date +%y%m%d-%H%M%S)"
fi

echo "==> Deploying FRONTEND tag: ${TAG}"
echo "==> ECR: ${ECR_URI}:${TAG}"

# # ==== LOGIN ECR ====
# echo "==> Logging in to ECR..."
# aws ecr get-login-password --region "${AWS_REGION}" \
# | docker login --username AWS --password-stdin "${ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com" >/dev/null

# ==== BUILD + PUSH ====
echo "==> Building & pushing image..."
# pushd FrontEnd >/dev/null
docker buildx build \
  --platform linux/amd64,linux/arm64 \
  -t "${ECR_URI}:${TAG}" \
  --push \
  .
# popd >/dev/null

# ==== UPDATE DEPLOYMENT IMAGE ====
echo "==> Updating Kubernetes deployment image..."
kubectl set image "deployment/${DEPLOYMENT}" \
  "${CONTAINER_NAME}=${ECR_URI}:${TAG}" \
  -n "${NAMESPACE}"

# ==== ROLLOUT STATUS ====
echo "==> Waiting for rollout..."
kubectl rollout status "deployment/${DEPLOYMENT}" -n "${NAMESPACE}"

# ==== VERIFY ====
echo "==> Verify deployment image:"
kubectl get deploy "${DEPLOYMENT}" -n "${NAMESPACE}" \
  -o=jsonpath='{.spec.template.spec.containers[0].image}{"\n"}'

echo "âœ… Done."

--- END: FrontEnd/deploy_frontend.sh ---

--- START: FrontEnd/eslint.config.js ---
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs['recommended-latest'],
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
--- END: FrontEnd/eslint.config.js ---

--- START: FrontEnd/index.html ---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>my-app</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
--- END: FrontEnd/index.html ---

--- START: FrontEnd/postcss.config.js ---


export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};

--- END: FrontEnd/postcss.config.js ---

--- START: FrontEnd/tailwind.config.js ---
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      fontFamily: {
        sans:["Inter", "sans-serif"],
      },
      colors: {
        primary: "#ff4f4f",
        secondary: "#4f4fff",
      },
    },
  },
  plugins: [],
}
--- END: FrontEnd/tailwind.config.js ---

--- START: FrontEnd/vite.config.js ---
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
  server: {
    host: '0.0.0.0',
    port: 5173
  }
})
--- END: FrontEnd/vite.config.js ---

--- START: FrontEnd/src/App.css ---
#root {
  width: 100%;
  margin: 0;
  padding: 0;
  text-align: initial;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
--- END: FrontEnd/src/App.css ---

--- START: FrontEnd/src/App.jsx ---
// ğŸ“ src/App.jsx
import { Routes, Route, Navigate, BrowserRouter } from "react-router-dom";
import Navbar from "./components/Navbar.jsx";
import UserHome from "./pages/UserHome.jsx";
import Login from "./pages/Login.jsx";
import ProtectedRoute from "./components/ProtectedRoute.jsx";
import Dashboard from "./pages/Dashboard.jsx";
import Register from "./pages/Register.jsx";
import Jobs from "./pages/jobs.jsx";
import MyApplications from "./pages/MyApplications.jsx";
import JobsFeed from "./pages/JobsFeed.jsx";
import CompleteProfile from "./pages/CompleteProfile.jsx";
import DashboardApplications from "./pages/DashboardApplications.jsx";
import DashboardApplicants from "./pages/DashboardApplicants.jsx";


import ManagerLayout from "./layouts/ManagerLayout";
import Dashboard from "./pages/Dashboard";
import ManagerJobs from "./pages/ManagerJobs";
import ManagerApplicants from "./pages/ManagerApplicants";
import ManagerApplications from "./pages/ManagerApplications";

import handsImg from "./assets/hands.jpg";


export default function App() {
  return (
    <>
      <BrowserRouter>
      <Navbar />
      <Routes>
        {/* âœ… ××¡×š ×”×‘×™×ª ×”×¦×™×‘×•×¨×™ â€“ ×—×“×© */}
        <Route path="/" element={<Home />} />

        <Route path="/login" element={<Login />} />

        <Route
          path="/user-home"
          element={
            <ProtectedRoute>
              <UserHome />
            </ProtectedRoute>
          }
        />

        <Route
          path="/dashboard"
          element={
            <ProtectedRoute adminOnly>
              <Dashboard />
            </ProtectedRoute>
          }
        />

        <Route path="/register" element={<Register />} />
        <Route
          path="/dashboard/jobs"
          element={
            <ProtectedRoute adminOnly>
              <Jobs />
            </ProtectedRoute>
          }
        />
        <Route
          path="/my-applications"
          element={
            <ProtectedRoute>
              <MyApplications />
            </ProtectedRoute>
          }
        />
        <Route path="/jobs-feed" element={<JobsFeed />} />
        <Route
          path="/complete-profile"
          element={
            <ProtectedRoute>
              <CompleteProfile />
            </ProtectedRoute>
          }
        />
        <Route
          path="/dashboard/applications"
          element={
            <ProtectedRoute adminOnly>
              <DashboardApplications />
            </ProtectedRoute>
          }
        />
        <Route
          path="/dashboard/applicants"
          element={
            <ProtectedRoute adminOnly>
              <DashboardApplicants />
            </ProtectedRoute>
          }
        />

        <Route path="*" element={<Navigate to="/" replace />} />
      
      
      </Routes>
      </BrowserRouter>
    </>
  );
}

/* =========================
   HOME â€“ ×”×¢××•×“ ×”×¨××©×™ ×”×—×“×©
   ========================= */
function Home() {
  return (
    <div className="bg-slate-50 text-slate-800">

      {/* HERO */}
      <section className="bg-gradient-to-b from-amber-100 to-stone-300 text-amber-800 py-24">
        <div className="max-w-6xl mx-auto px-6 grid md:grid-cols-2 gap-12 items-center">

          <div>
            <h1 className="text-5xl font-extrabold leading-tight">
              Build Your DevSecOps Career
            </h1>
            <p className="mt-6 text-lg text-amber-700">
              Connecting DevOps & Security professionals with companies that value excellence!!
            </p>

          </div>

          <div className="hidden md:block rounded-xl overflow-hidden shadow-lg">
            <img
              src={handsImg}
              alt="DevSecOps"
              className="w-full"
            />
          </div>

        </div>
      </section>

      {/* FEATURES */}
      <section className="py-20">
        <div className="max-w-6xl mx-auto px-6 grid md:grid-cols-3 gap-8">

          {[
            { title: "Secure Hiring", icon: "ğŸ”", text: "Security-first recruitment process." },
            { title: "Cloud & DevOps", icon: "â˜ï¸", text: "Focused on modern infrastructure roles." },
            { title: "Career Growth", icon: "ğŸš€", text: "Opportunities that scale with you." }
          ].map((f, i) => (
            <div
              key={i}
              className="bg-white rounded-2xl shadow p-8 text-center hover:shadow-lg transition"
            >
              <div className="text-4xl mb-4">{f.icon}</div>
              <h3 className="text-xl font-bold">{f.title}</h3>
              <p className="mt-2 text-slate-600">{f.text}</p>
            </div>
          ))}

        </div>
      </section>


    </div>
  );
}
--- END: FrontEnd/src/App.jsx ---

--- START: FrontEnd/src/index.css ---
@tailwind base;
@tailwind components;
@tailwind utilities;
--- END: FrontEnd/src/index.css ---

--- START: FrontEnd/src/main.jsx ---
// ğŸ“ src/main.jsx
import React from "react";
import ReactDOM from "react-dom/client";
import { BrowserRouter } from "react-router-dom";
import App from "./App.jsx";
import "./index.css";
import { AuthProvider } from "./context/AuthContext.jsx";

ReactDOM.createRoot(document.getElementById("root")).render(
  <React.StrictMode>
    <BrowserRouter>
      <AuthProvider>
        <App />
      </AuthProvider>
    </BrowserRouter>
  </React.StrictMode>
);

--- END: FrontEnd/src/main.jsx ---

--- START: FrontEnd/src/layouts/ManagerLayout.jsx ---
import { Outlet, useNavigate } from "react-router-dom";

export default function ManagerLayout() {
  const navigate = useNavigate();

  return (
    <div
      dir="rtl"
      className="min-h-screen bg-gradient-to-br from-purple-600 via-sky-600 to-green-400"
    >
      <div className="p-10">
        {/* Top bar ×›×œ×œ×™ ×œ×× ×”×œ */}
        <div className="max-w-6xl mx-auto flex items-center justify-between mb-10">
          <button
            onClick={() => navigate(-1)}
            className="bg-white/15 backdrop-blur-md border border-white/20 text-white px-4 py-2 rounded-xl shadow-lg hover:bg-white/20 transition"
          >
            â† ×—×–×¨×”
          </button>

          <div className="text-center">
            <div className="text-3xl md:text-4xl font-assistant text-white drop-shadow-xl">
              Manager Area
            </div>
            <div className="text-white/80 mt-1">
              × ×™×”×•×œ ××©×¨×•×ª Â· ××•×¢××“×™× Â· ××•×¢××“×•×™×•×ª
            </div>
          </div>

          <div className="w-[90px]" />
        </div>

        {/* ×ª×•×›×Ÿ ×”×¢××•×“×™× ×©×œ ×”×× ×”×œ ×™×•×©×‘ ×›××Ÿ */}
        <div className="max-w-6xl mx-auto bg-white/15 backdrop-blur-md border border-white/20 rounded-2xl shadow-2xl p-8">
          <Outlet />
        </div>
      </div>
    </div>
  );
}
--- END: FrontEnd/src/layouts/ManagerLayout.jsx ---

--- START: FrontEnd/src/context/AuthContext.jsx ---
// ğŸ“ src/context/AuthContext.jsx
import { createContext, useState, useEffect, useContext } from "react";

export const AuthContext = createContext(null);

export function AuthProvider({ children }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true); // ××¦×‘ ×˜×¢×™× ×” ×‘×–××Ÿ ×‘×“×™×§×” ×¨××©×•× ×™×ª

  useEffect(() => {
    try {
      const token = localStorage.getItem("token");
      const storedUser = localStorage.getItem("user");

      if (token && storedUser) {
        setUser(JSON.parse(storedUser));
      }
    } catch (error) {
      console.error("âš ï¸ Failed to parse user from localStorage:", error);
      localStorage.removeItem("token");
      localStorage.removeItem("user");
    } finally {
      setLoading(false); // ×ª××™×“ ××¡×™×™× ×˜×¢×™× ×”
    }
  }, []);

  const login = (userData, token) => {
    try {
      if (token) localStorage.setItem("token", token);
      if (userData) localStorage.setItem("user", JSON.stringify(userData));
      setUser(userData);
    } catch (error) {
      console.error("âš ï¸ Failed to save user to localStorage:", error);
    }
  };

  const logout = () => {
    localStorage.removeItem("token");
    localStorage.removeItem("user");
    setUser(null);
  };

  return (
    <AuthContext.Provider value={{ user, login, logout, loading }}>
      {children}
    </AuthContext.Provider>
  );
}

// Hook ××•×ª×× ××™×©×™×ª ×œ×©×™××•×© ×¤×©×•×˜ ×‘-AuthContext
export function useAuth() {
  return useContext(AuthContext);
}
--- END: FrontEnd/src/context/AuthContext.jsx ---

--- START: FrontEnd/src/api/client.js ---
// ×§×œ×™×™× ×˜ Axios ×¢× baseURL ××—×™×“
import axios from "axios";

const api = axios.create({
  baseURL: "",
  headers: { "Content-Type": "application/json" },
});

export default api;
--- END: FrontEnd/src/api/client.js ---

--- START: FrontEnd/src/pages/CompleteProfile.jsx ---
import { useState } from "react";
import api from "../api/client.js";
import { useAuth } from "../context/AuthContext.jsx";
import { useNavigate } from "react-router-dom";

export default function CompleteProfile() {
  const { user } = useAuth();
  const token = localStorage.getItem("token");
  const navigate = useNavigate();

  const [name, setName] = useState(user?.username || "");
  const [languages, setLanguages] = useState("");
  const [technologies, setTechnologies] = useState("");
  const [flagshipProject, setFlagshipProject] = useState("");
  const [lastJob, setLastJob] = useState("");
  const [education, setEducation] = useState("");
  const [yearsExperience, setYearsExperience] = useState("");
  const [resumePath, setResumePath] = useState("");

  const [loading, setLoading] = useState(false);

  const authHeader = token ? { Authorization: `Bearer ${token}` } : {};

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);

    try {
      await api.put(
        `/applicants/${user.applicant_id}`, // âš¡ ×¦×¨×™×š ×œ×”×ª××™× ×œ× ×ª×™×‘ ××¦×œ×š ×‘×‘×§×× ×“
        {
          name,
          languages,
          technologies,
          flagship_project: flagshipProject,
          last_job: lastJob,
          education,
          years_experience: parseInt(yearsExperience, 10) || 0,
          resume_path: resumePath,
        },
        { headers: authHeader }
      );

      alert("×”×¤×¨×•×¤×™×œ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×” âœ…");
      navigate("/user-home"); // ××—×¨×™ ×©××™×œ× ×¢×•×‘×¨×™× ×œ×¤×™×“
    } catch (err) {
      console.error("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×¤×¨×•×¤×™×œ:", err);
      alert("×©×’×™××” ×‘×¢×“×›×•×Ÿ ×¤×¨×•×¤×™×œ âŒ");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-400 to-blue-500 p-6">
      <form
        onSubmit={handleSubmit}
        className="bg-white rounded-xl shadow-xl p-8 w-full max-w-2xl"
      >
        <h1 className="text-3xl font-bold text-gray-800 text-center mb-8">
          ×”×©×œ××ª ×¤×¨×•×¤×™×œ ××•×¢××“ ğŸ‘¤
        </h1>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label className="block text-gray-700 font-medium mb-1">
              ×©× ××œ×
            </label>
            <input
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              className="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-400"
              required
            />
          </div>

          <div>
            <label className="block text-gray-700 font-medium mb-1">
              ×©×¤×•×ª ×ª×›× ×•×ª
            </label>
            <input
              type="text"
              value={languages}
              onChange={(e) => setLanguages(e.target.value)}
              placeholder="Python, JavaScript, Go..."
              className="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-400"
            />
          </div>

          <div>
            <label className="block text-gray-700 font-medium mb-1">
              ×˜×›× ×•×œ×•×’×™×•×ª
            </label>
            <input
              type="text"
              value={technologies}
              onChange={(e) => setTechnologies(e.target.value)}
              placeholder="AWS, Docker, Kubernetes..."
              className="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-400"
            />
          </div>

          <div>
            <label className="block text-gray-700 font-medium mb-1">
              ×¤×¨×•×™×§×˜ ×“×’×œ
            </label>
            <input
              type="text"
              value={flagshipProject}
              onChange={(e) => setFlagshipProject(e.target.value)}
              placeholder="×¤×¨×•×™×§×˜ ××™×•×—×“ ×©××ª×” ×’××” ×‘×•"
              className="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-400"
            />
          </div>

          <div>
            <label className="block text-gray-700 font-medium mb-1">
              ××§×•× ×¢×‘×•×“×” ××—×¨×•×Ÿ
            </label>
            <input
              type="text"
              value={lastJob}
              onChange={(e) => setLastJob(e.target.value)}
              className="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-400"
            />
          </div>

          <div>
            <label className="block text-gray-700 font-medium mb-1">
              ×”×©×›×œ×”
            </label>
            <input
              type="text"
              value={education}
              onChange={(e) => setEducation(e.target.value)}
              className="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-400"
            />
          </div>

          <div>
            <label className="block text-gray-700 font-medium mb-1">
              ×©× ×•×ª × ×™×¡×™×•×Ÿ
            </label>
            <input
              type="number"
              value={yearsExperience}
              onChange={(e) => setYearsExperience(e.target.value)}
              className="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-400"
            />
          </div>

          <div>
            <label className="block text-gray-700 font-medium mb-1">
              ×§×•×‘×¥ ×§×•"×— (× ×ª×™×‘/URL)
            </label>
            <input
              type="text"
              value={resumePath}
              onChange={(e) => setResumePath(e.target.value)}
              placeholder="×œ××©×œ: uploads/resume.pdf"
              className="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-400"
            />
          </div>
        </div>

        <button
          type="submit"
          disabled={loading}
          className="mt-8 w-full bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 rounded-lg font-semibold hover:scale-105 transition disabled:opacity-50"
        >
          {loading ? "×©×•××¨..." : "×©××•×¨ ×¤×¨×•×¤×™×œ"}
        </button>
      </form>
    </div>
  );
}
--- END: FrontEnd/src/pages/CompleteProfile.jsx ---

--- START: FrontEnd/src/pages/Dashboard.jsx ---
// ğŸ“ src/pages/Dashboard.jsx

import {useNavigate} from "react-router-dom";
export default function Dashboard() {
  const navigate = useNavigate();
  const cards = [
    {
      title: "×”××©×¨×•×ª ×©×œ×™",
      description: "×¦×¤×” ×•× ×”×œ ××ª ×›×œ ×”××©×¨×•×ª ×©×¤×¨×¡××ª ×‘××¢×¨×›×ª",
      link: "/dashboard/jobs",
      color: "from-blue-500 to-purple-600",
    },
    {
      title: "××•×¢××“×•×™×•×ª ×©×”×•×’×©×•",
      description: "×‘×“×•×§ ××™ ×”×’×™×© ××•×¢××“×•×ª ×œ××©×¨×•×ª ×©×œ×š ×•× ×”×œ ××ª ×”×¡×˜×˜×•×¡",
      link: "/dashboard/applications",
      color: "from-green-400 to-green-700",
    },
    {
      title: "×××’×¨ ××•×¢××“×™×",
      description: "×’×™×©×” ×œ×¨×©×™××ª ××•×¢××“×™× ×¤×•×˜× ×¦×™××œ×™×™× ×‘××¢×¨×›×ª",
      link: "/dashboard/applicants",
      color: "from-pink-500 to-purple-500",
    },
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-sky-600 to-green-400 p-10 flex flex-col items-center">
      {/* ×›×•×ª×¨×ª ×’×“×•×œ×” ×•×‘×•×œ×˜×ª */}
      <h1 className="text-5xl font-assistant text-white  drop-shadow-xl mb-12">
        <br />
        Dashboard Manager ğŸ“Š
      </h1>
     


      {/* ×¨×©×ª ×”×›×¨×˜×™×¡×™× */}
      <div className="grid md:grid-cols-3 gap-8 max-w-6xl w-full">
        {cards.map((card) => (
          <div
            key={card.title}
            className={`bg-gradient-to-r ${card.color} text-white rounded-2xl shadow-xl p-8 hover:scale-105 hover:shadow-2xl transition cursor-pointer`}
            onClick={() => navigate(card.link)}
          >
            <h2 className="text-2xl font-bold mb-3">{card.title}</h2>
            <p className="text-white/90">{card.description}</p>
          </div>
        ))}
      </div>
    </div>
  );
}
--- END: FrontEnd/src/pages/Dashboard.jsx ---

--- START: FrontEnd/src/pages/DashboardApplicants.jsx ---
// FrontEnd/src/pages/DashboardApplicants.jsx
export default function DashboardApplicants() {
  return <div style={{padding: 20}}>×‘×§×¨×•×‘: ×××’×¨ ××•×¢××“×™×</div>;
}
--- END: FrontEnd/src/pages/DashboardApplicants.jsx ---

--- START: FrontEnd/src/pages/DashboardApplications.jsx ---
import { useEffect, useState } from "react";
import api from "../api/client.js";
import { useAuth } from "../context/AuthContext.jsx";

export default function DashboardApplications() {
  const { user } = useAuth();
  const token = localStorage.getItem("token");

  const [applications, setApplications] = useState([]);
  const [loading, setLoading] = useState(true);

  const authHeader = token ? { Authorization: `Bearer ${token}` } : {};

  useEffect(() => {
    if (!user || !user.is_admin) return;

    (async () => {
      try {
        const res = await api.get(`/apply/publisher/${user.id}`, {
          headers: authHeader,
        });
        setApplications(res.data || []);
      } catch (err) {
        console.error("×©×’×™××” ×‘×˜×¢×™× ×ª ××•×¢××“×•×™×•×ª:", err);
      } finally {
        setLoading(false);
      }
    })();
  }, [user]);

  return (
    <div className="min-h-screen bg-gradient-to-r from-gray-100 to-blue-200 p-6">
      <h1 className="text-4xl font-assistant text-gray-800 text-center mb-10">
        ××•×¢××“×•×™×•×ª ×œ××©×¨×•×ª ×©×¤×¨×¡××ª ğŸ“„
      </h1>

      {loading ? (
        <p className="text-center text-gray-600">×˜×•×¢×Ÿ ××•×¢××“×•×™×•×ªâ€¦</p>
      ) : applications.length === 0 ? (
        <p className="text-center text-gray-600">
          ×œ× ×”×•×’×©×• ××•×¢××“×•×™×•×ª ×œ××©×¨×•×ª ×©×œ×š ×¢×“×™×™×Ÿ.
        </p>
      ) : (
        <div className="grid gap-6 max-w-4xl mx-auto">
          {applications.map((app) => (
            <div
              key={app.id}
              className="bg-white rounded-xl shadow hover:shadow-xl transition p-6"
            >
              <h2 className="text-2xl font-semibold text-gray-800">
                {app.job_title}
              </h2>
              <p className="text-gray-600">{app.job_description}</p>

              <p className="mt-2">
                <span className="font-bold">××•×¢××“:</span>{" "}
                {app.applicant_name || "×œ× ×¦×•×™×Ÿ"}
              </p>
              <p>
                <span className="font-bold">×¡×˜×˜×•×¡:</span>{" "}
                <span
                  className={`${
                    app.status === "pending"
                      ? "text-yellow-600"
                      : app.status === "approved"
                      ? "text-green-600"
                      : "text-red-600"
                  }`}
                >
                  {app.status}
                </span>
              </p>
              <p>
                <span className="font-bold">×¦×™×•×Ÿ ×”×ª×××”:</span>{" "}
                <span className="text-blue-600 font-bold">{app.score}</span>
              </p>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}
--- END: FrontEnd/src/pages/DashboardApplications.jsx ---

--- START: FrontEnd/src/pages/JobsFeed.jsx ---
import { useEffect, useState } from "react";
import api from "../api/client.js";
import { useAuth } from "../context/AuthContext.jsx";

export default function JobsFeed() {
  const { user } = useAuth();
  const token = localStorage.getItem("token");

  const [jobs, setJobs] = useState([]);
  const [applications, setApplications] = useState([]);
  const [loading, setLoading] = useState(true);

  const authHeader = token ? { Authorization: `Bearer ${token}` } : {};

  // ×˜×¢×™× ×ª ×›×œ ×”××©×¨×•×ª
  useEffect(() => {
    (async () => {
      try {
        const res = await api.get("/jobs/", { headers: authHeader });
        setJobs(res.data || []);
      } catch (err) {
        console.error("×©×’×™××” ×‘×˜×¢×™× ×ª ××©×¨×•×ª:", err);
      } finally {
        setLoading(false);
      }
    })();
  }, []);

  // ×˜×¢×™× ×ª ×”××•×¢××“×•×™×•×ª ×©×œ ×”××©×ª××©
  useEffect(() => {
    if (!user) return;
    (async () => {
      try {
        const res = await api.get(`/apply/user/${user.id}`, { headers: authHeader });
        setApplications(res.data || []);
      } catch (err) {
        console.error("×©×’×™××” ×‘×˜×¢×™× ×ª ××•×¢××“×•×™×•×ª:", err);
      }
    })();
  }, [user]);

  // ×‘×“×™×§×” ×× ×›×‘×¨ ×”×•×’×©×” ××•×¢××“×•×ª
  const hasApplied = (jobId) => {
    return applications.some((app) => app.job_id === jobId);
  };

  // ×”×’×©×ª ××•×¢××“×•×ª ×œ××©×¨×”
  const applyToJob = async (jobId) => {
    if (!user) return alert("×™×© ×œ×”×ª×—×‘×¨ ×§×•×“×");
    try {
      await api.post(
        `/apply/${jobId}`,
        { applicant_id: user.id },
        { headers: authHeader }
      );
      alert("×”××•×¢××“×•×ª × ×©×œ×—×” ×‘×”×¦×œ×—×” âœ…");
      setApplications((prev) => [...prev, { job_id: jobId, applicant_id: user.id }]);
    } catch (err) {
      console.error("×©×’×™××” ×‘×”×’×©×ª ××•×¢××“×•×ª:", err);
      alert("×©×’×™××” ×‘×”×’×©×ª ××•×¢××“×•×ª âŒ");
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-r from-gray-200 to-blue-300 p-6">
      <br />
      {loading ? (
        <p className="text-center text-gray-600">×˜×•×¢×Ÿ ××©×¨×•×ªâ€¦</p>
      ) : jobs.length === 0 ? (
        <p className="text-center text-gray-600">××™×Ÿ ××©×¨×•×ª ×›×¨×’×¢.</p>
      ) : (
        <div className="grid gap-6 max-w-3xl mx-auto">
          {jobs.map((job) => (
            <div
              key={job.id}
              className="bg-gradient-to-r from-yellow-200 to-green-300 rounded-xl shadow hover:shadow-xl transition p-6"
            >
              <h2 className="text-2xl font-semibold text-gray-800">{job.title}</h2>
              <p className="text-gray-500 mt-1">
                {job.work_location || "××™×§×•× ×œ× ×¦×•×™×Ÿ"} Â· {job.employment_type || "×”×™×§×£ ×œ× ×¦×•×™×Ÿ"}
              </p>
              <p className="text-gray-700 mt-3">{job.description}</p>
              <button
                onClick={() => applyToJob(job.id)}
                disabled={hasApplied(job.id)}
                className={`mt-4 px-5 py-2 rounded-lg text-white transition ${
                  hasApplied(job.id)
                    ? "bg-gray-400 cursor-not-allowed"
                    : "bg-gradient-to-r from-purple-600 to-pink-500 hover:scale-105 hover:shadow-lg"
                }`}
              >
                {hasApplied(job.id) ? "×›×‘×¨ ×”×•×’×©×” ××•×¢××“×•×ª" : "×”×’×© ××•×¢××“×•×ª"}
              </button>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}
--- END: FrontEnd/src/pages/JobsFeed.jsx ---

--- START: FrontEnd/src/pages/Login.jsx ---
// ğŸ“ src/pages/Login.jsx
import { useState } from "react";
import { useAuth } from "../context/AuthContext.jsx";
import axios from "axios";
import { useNavigate } from "react-router-dom";
import api from "../api/client.js";

export default function Login() {
  const { login } = useAuth();
  const navigate = useNavigate();

  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);

    try {
      // ×©×œ×™×—×ª ×‘×§×©×” ×œ-API ×©×œ×š
      const res = await api.post("/auth/login", {
        email,
        password,
      });

      // ×©××™×¨×ª ×˜×•×§×Ÿ + ×¤×¨×˜×™ ××©×ª××©
      login(res.data.user, res.data.access_token);

      // ×”×¤× ×™×” ×œ××¡×š ×”××ª××™×
      if (res.data.user.is_admin) {
        navigate("/dashboard");
      } else {
        navigate("/user-home");
      }
    } catch (error) {
      console.error(error);
      alert("×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª - ×‘×“×•×§ ××ª ×¤×¨×˜×™ ×”××©×ª××© ×©×œ×š");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-600 to-pink-500">
      <form
        onSubmit={handleSubmit}
        className="bg-white rounded-xl shadow-xl p-8 w-full max-w-md"
      >
        <h1 className="text-3xl font-bold text-gray-800 text-center mb-6">
          ×”×ª×—×‘×¨×•×ª ğŸ”‘
        </h1>

        <div className="mb-4">
          <label className="block text-gray-700 font-medium mb-1">××™××™×™×œ</label>
          <input
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-pink-400 focus:outline-none"
            placeholder="you@example.com"
            required
          />
        </div>

        <div className="mb-6">
          <label className="block text-gray-700 font-medium mb-1">×¡×™×¡××”</label>
          <input
            type="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-pink-400 focus:outline-none"
            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
            required
          />
        </div>

        <button
          type="submit"
          disabled={loading}
          className="w-full bg-gradient-to-r from-purple-600 to-pink-500 text-white py-2 rounded-lg font-semibold hover:scale-105 hover:shadow-lg transition disabled:opacity-50"
        >
          {loading ? "××ª×—×‘×¨..." : "×”×ª×—×‘×¨"}
        </button>

        <p className="text-center text-gray-600 mt-4">
          ××™×Ÿ ×œ×š ×—×©×‘×•×Ÿ?{" "}
          <a href="/register" className="text-pink-600 hover:underline">
            ×¦×•×¨ ××—×“ ×›××Ÿ
          </a>
        </p>
      </form>
    </div>
  );
}
--- END: FrontEnd/src/pages/Login.jsx ---

--- START: FrontEnd/src/pages/MyApplications.jsx ---
import { useEffect, useState } from "react";
import api from "../api/client.js";
import { useAuth } from "../context/AuthContext.jsx";

export default function MyApplications() {
  const { user } = useAuth();
  const token = localStorage.getItem("token");

  const [applications, setApplications] = useState([]);
  const [loading, setLoading] = useState(true);

  const authHeader = token ? { Authorization: `Bearer ${token}` } : {};

  // ×˜×¢×™× ×ª ×”××•×¢××“×•×™×•×ª
  useEffect(() => {
    if (!user) return;
    (async () => {
      try {
        const res = await api.get(`/apply/user/${user.id}`, { headers: authHeader });
        setApplications(res.data || []);
      } catch (err) {
        console.error("×©×’×™××” ×‘×˜×¢×™× ×ª ××•×¢××“×•×™×•×ª:", err);
      } finally {
        setLoading(false);
      }
    })();
  }, [user]);

  return (
    <div className="min-h-screen bg-gradient-to-r from-gray-100 to-blue-200 p-6">
      <h1 className="text-4xl font-assistant text-gray-800 text-center mb-10">
        ×”××•×¢××“×•×™×•×ª ×©×œ×™ ğŸ“„
      </h1>

      {loading ? (
        <p className="text-center text-gray-600">×˜×•×¢×Ÿ ××•×¢××“×•×™×•×ªâ€¦</p>
      ) : applications.length === 0 ? (
        <p className="text-center text-gray-600">×œ× ×”×•×’×©×• ××•×¢××“×•×™×•×ª ×¢×“×™×™×Ÿ.</p>
      ) : (
        <div className="grid gap-6 max-w-3xl mx-auto">
  {applications.map((app) => (
    <div
      key={app.id}
      className="bg-white rounded-xl shadow hover:shadow-xl transition p-6"
    >
      <h2 className="text-2xl font-semibold text-gray-800">
        {app.job_title || "××©×¨×” ×œ×œ× ×©×"}
      </h2>

      <p className="text-gray-600 mt-2">
        {app.description || "××™×Ÿ ×ª×™××•×¨ ×–××™×Ÿ"}
      </p>

      <p className="text-gray-500 mt-3">
        ×¡×˜×˜×•×¡:{" "}
        <span
          className={`font-semibold ${
            app.status === "pending"
              ? "text-yellow-600"
              : app.status === "approved"
              ? "text-green-600"
              : "text-red-600"
          }`}
        >
          {app.status || "×œ× ×¦×•×™×Ÿ"}
        </span>
      </p>

      <p className="text-gray-700 mt-2">
        ×¦×™×•×Ÿ ×”×ª×××”:{" "}
        <span className="font-bold text-blue-600">
          {app.score !== null ? app.score : "×œ× ×—×•×©×‘ ×¢×“×™×™×Ÿ"}
        </span>
      </p>

      <p className="text-gray-700 mt-3">
        {app.notes || "××™×Ÿ ×”×¢×¨×•×ª × ×•×¡×¤×•×ª"}
      </p>
    </div>
  ))}
</div>

      )}
    </div>
  );
}
--- END: FrontEnd/src/pages/MyApplications.jsx ---

--- START: FrontEnd/src/pages/Register.jsx ---
// ğŸ“ src/pages/Register.jsx
import { useState } from "react";
import axios from "axios";
import { useNavigate } from "react-router-dom";
import { useAuth } from "../context/AuthContext.jsx";
import api from "../api/client.js";

export default function Register() {
  const { login } = useAuth();
  const navigate = useNavigate();

  const [username, setUsername] = useState("");
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [isAdmin, setIsAdmin] = useState(false);
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);

    try {
      const res = await api.post("/auth/register", {
        username,
        email,
        password,
        is_admin: isAdmin, // âœ… ×©×•×œ×—×™× ×œ-Backend
      });

      // ×©××™×¨×ª ×”××©×ª××© ×•-token ×‘-AuthContext + localStorage
      login(res.data.user, res.data.access_token);

      // ×”×¤× ×™×” ×œ××¡×š ×”××ª××™×
      if (res.data.user.is_admin) {
        navigate("/dashboard");
      } else {
        navigate("/complete-profile"); // × ×™×¦×•×¨ ×‘×§×¨×•×‘ ×“×£ ×”×©×œ××ª ×¤×¨×•×¤×™×œ
      }
    } catch (error) {
      console.error(error);
      alert("×©×’×™××” ×‘×”×¨×©××” - ×× × × ×¡×” ×©×•×‘");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-600 to-purple-600">
      <form
        onSubmit={handleSubmit}
        className="bg-white rounded-xl shadow-xl p-8 w-full max-w-md"
      >
        <h1 className="text-3xl font-bold text-gray-800 text-center mb-6">
          ×”×¨×©××” ğŸ“
        </h1>

        <div className="mb-4">
          <label className="block text-gray-700 font-medium mb-1">
            ×©× ××©×ª××©
          </label>
          <input
            type="text"
            value={username}
            onChange={(e) => setUsername(e.target.value)}
            className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-400 focus:outline-none"
            placeholder="×‘×—×¨ ×©× ××©×ª××©"
            required
          />
        </div>

        <div className="mb-4">
          <label className="block text-gray-700 font-medium mb-1">××™××™×™×œ</label>
          <input
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-400 focus:outline-none"
            placeholder="you@example.com"
            required
          />
        </div>

        <div className="mb-6">
          <label className="block text-gray-700 font-medium mb-1">×¡×™×¡××”</label>
          <input
            type="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-400 focus:outline-none"
            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
            required
          />
        </div>

        <div className="mb-6 flex items-center gap-2">
          <input
            type="checkbox"
            checked={isAdmin}
            onChange={(e) => setIsAdmin(e.target.checked)}
          />
          <label className="text-gray-700 font-medium">×× ×™ ××’×™×™×¡ (Recruiter)</label>
        </div>

        <button
          type="submit"
          disabled={loading}
          className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-2 rounded-lg font-semibold hover:scale-105 hover:shadow-lg transition disabled:opacity-50"
        >
          {loading ? "× ×¨×©×..." : "×¦×•×¨ ×—×©×‘×•×Ÿ"}
        </button>

        <p className="text-center text-gray-600 mt-4">
          ×›×‘×¨ ×™×© ×œ×š ×—×©×‘×•×Ÿ?{" "}
          <a href="/login" className="text-purple-600 hover:underline">
            ×”×ª×—×‘×¨ ×›××Ÿ
          </a>
        </p>
      </form>
    </div>
  );
}
--- END: FrontEnd/src/pages/Register.jsx ---

--- START: FrontEnd/src/pages/UserHome.jsx ---
// ğŸ“ src/pages/UserHome.jsx
import { useNavigate } from "react-router-dom";

export default function UserHome() {
  const navigate = useNavigate();

  const cards = [
    {
      title: "×”××•×¢××“×•×™×•×ª ×©×œ×™ ğŸ“„",
      desc: "×¦×¤×” ×•× ×”×œ ××ª ×›×œ ×”××©×¨×•×ª ×©×”×’×©×ª ××œ×™×”×Ÿ",
      color: "from-purple-400 to-pink-500",
      onClick: () => navigate("/my-applications"),
    },
    {
      title: "×”××’×™×™×¡×™× ×©×œ×™ ğŸ‘¥",
      desc: "× ×”×œ ××ª ×”×§×©×¨ ×©×œ×š ×¢× ×”××’×™×™×¡×™× ×‘××¢×¨×›×ª",
      color: "from-green-400 to-blue-500",
      onClick: () => navigate("/recruiters"),
    },
    {
      title: "××©×¨×•×ª ×¤×ª×•×—×•×ª ğŸ“¢",
      desc: "×¦×¤×” ×‘×›×œ ×”××©×¨×•×ª ×”×¤×ª×•×—×•×ª ×•×”×’×© ××•×¢××“×•×ª",
      color: "from-yellow-400 to-red-300",
      onClick: () => navigate("/jobs-feed"),
    },
  ];

  return (
    <div className="min-h-screen bg-gradient-to-r from-gray-200 to-blue-300 p-10">
      <h1 className="text-4xl font-assistant text-gray-800 text-center mb-12">
        Welcome to DevSecJobs! ğŸš€
      </h1>

      {/* ×©×œ×•×© ×›×¨×˜×™×¡×™×•×ª ×™×¤×•×ª */}
      <div className="grid md:grid-cols-3 gap-8 max-w-5xl mx-auto">
        {cards.map((card, i) => (
          <div
            key={i}
            onClick={card.onClick}
            className={`cursor-pointer bg-gradient-to-r ${card.color} rounded-2xl shadow-lg hover:scale-105 hover:shadow-2xl transition p-8 text-white`}
          >
            <h2 className="text-2xl font-bold mb-3">{card.title}</h2>
            <p className="text-white/90">{card.desc}</p>
          </div>
        ))}
      </div>
    </div>
  );
}
--- END: FrontEnd/src/pages/UserHome.jsx ---

--- START: FrontEnd/src/pages/jobs.jsx ---
import { useEffect, useState } from "react";
import api from "../api/client.js";
import { useAuth } from "../context/AuthContext.jsx";

export default function Jobs() {
  const { user } = useAuth();
  const token = typeof window !== "undefined" ? localStorage.getItem("token") : null;

  const [jobs, setJobs] = useState([]);
  const [loading, setLoading] = useState(true);
  const [creating, setCreating] = useState(false);

  const [form, setForm] = useState({
    title: "",
    employment_type: "",
    work_location: "",
    description: "",
    required_technologies: "",
    required_experience: "",
    is_open: true,
  });

  const authHeader = token ? { Authorization: `Bearer ${token}` } : {};

  // ×˜×¢×™× ×ª ××©×¨×•×ª (×œ×¤×™ ×”Ö¾API ×©×œ×š â€“ GET /jobs/)
  useEffect(() => {
    (async () => {
      try {
        const res = await api.get("/jobs/", { headers: authHeader });
        setJobs(res.data || []);
      } catch (e) {
        console.error(e);
        alert("× ×›×©×œ ×‘×˜×¢×™× ×ª ××©×¨×•×ª");
      } finally {
        setLoading(false);
      }
    })();
  }, []);

  const onChange = (e) => {
    const { name, value, type, checked } = e.target;
    setForm((f) => ({ ...f, [name]: type === "checkbox" ? checked : value }));
  };

  // ×™×¦×™×¨×ª ××©×¨×” (POST /jobs/) â€” ×“×•×¨×© JWT + ××“××™×Ÿ, ×•×©×•×œ×—×™× publisher_id ×œ×¤×™ ×”××•×“×œ ×©×œ×š
  const createJob = async (e) => {
    e.preventDefault();
    if (!user) return alert("×™×© ×œ×”×ª×—×‘×¨");
    if (!form.title.trim()) return alert("×—×•×‘×” ×œ××œ× ×›×•×ª×¨×ª ××©×¨×”");

    try {
      const payload = {
        ...form,
        required_experience: form.required_experience
          ? Number(form.required_experience)
          : null,
        publisher_id: user.id, // ×”Ö¾Backend ×œ× ×’×•×–×¨ ×–××ª ××”×˜×•×§×Ÿ, ××– ×©×•×œ×—×™× ××¤×”
      };
      await api.post("/jobs/", payload, { headers: authHeader });
      // ×¨×¢× ×•×Ÿ ×”×¨×©×™××”
      const list = await api.get("/jobs/", { headers: authHeader });
      setJobs(list.data || []);
      setCreating(false);
      setForm({
        title: "",
        employment_type: "",
        work_location: "",
        description: "",
        required_technologies: "",
        required_experience: "",
        is_open: true,
      });
    } catch (e) {
      console.error(e);
      alert("×™×¦×™×¨×ª ××©×¨×” × ×›×©×œ×” (× ×“×¨×© Admin + JWT ×ª×§×£)");
    }
  };

  // ××—×™×§×ª ××©×¨×” (DELETE /jobs/<id>) â€” ×“×•×¨×© JWT + ××“××™×Ÿ
  const deleteJob = async (id) => {
    if (!confirm("×œ××—×•×§ ××ª ×”××©×¨×”?")) return;
    try {
      await api.delete(`/jobs/${id}`, { headers: authHeader });
      setJobs((prev) => prev.filter((j) => j.id !== id));
    } catch (e) {
      console.error(e);
      alert("××—×™×§×” × ×›×©×œ×” (× ×“×¨×© Admin + JWT)");
    }
  };

  // ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ is_open (PUT /jobs/<id>)
  const toggleOpen = async (job) => {
    try {
      const res = await api.put(
        `/jobs/${job.id}`,
        { is_open: !job.is_open },
        { headers: authHeader }
      );
      setJobs((prev) => prev.map((j) => (j.id === job.id ? { ...j, is_open: res.data.is_open } : j)));
    } catch (e) {
      console.error(e);
      alert("×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ × ×›×©×œ");
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-sky-600 to-green-400 py-6 pr-6 pl-0">
      <div className="w-full text-right pr-4" dir="rtl">
        <div className="w-full flex items-center justify-end gap-4 mb-6">
          <button
            onClick={() => setCreating(true)}
            className="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-pink-500 text-white hover:scale-105 hover:shadow-md transition"
          >
           <span className="text-lg leading-none">+</span>
            <span>××©×¨×” ×—×“×©×”</span>
          </button>
        <h1 dir ="rtl"
        className="w-full text-3xl font-assistant-semibold text-black text-right">×”××©×¨×•×ª ×©×œ×™</h1>

        </div>

        {creating && (
          <form
            onSubmit={createJob}
            className="bg-white rounded-xl shadow p-6 mb-8 grid md:grid-cols-2 gap-4"
          >
            <input
              name="title"
              value={form.title}
              onChange={onChange}
              placeholder="×›×•×ª×¨×ª ××©×¨×” *"
              className="border rounded-lg px-3 py-2"
              required
            />
            <input
              name="employment_type"
              value={form.employment_type}
              onChange={onChange}
              placeholder="×¡×•×’ ×”×¢×¡×§×” (Full/Part)"
              className="border rounded-lg px-3 py-2"
            />
            <input
              name="work_location"
              value={form.work_location}
              onChange={onChange}
              placeholder="××™×§×•× ×¢×‘×•×“×” (Office/Home/Hybrid)"
              className="border rounded-lg px-3 py-2"
            />
            <input
              name="required_technologies"
              value={form.required_technologies}
              onChange={onChange}
              placeholder="×˜×›× ×•×œ×•×’×™×•×ª × ×“×¨×©×•×ª (CSV: AWS, Docker, K8s)"
              className="border rounded-lg px-3 py-2 md:col-span-2"
            />
            <input
              type="number"
              min="0"
              name="required_experience"
              value={form.required_experience}
              onChange={onChange}
              placeholder="×©× ×•×ª × ×™×¡×™×•×Ÿ × ×“×¨×©×•×ª"
              className="border rounded-lg px-3 py-2"
            />
            <label className="flex items-center gap-2">
              <input
                type="checkbox"
                name="is_open"
                checked={form.is_open}
                onChange={onChange}
              />
              ××©×¨×” ×¤×ª×•×—×” ×œ×§×œ×™×˜×”
            </label>
            <textarea
              name="description"
              value={form.description}
              onChange={onChange}
              placeholder="×ª×™××•×¨ ××©×¨×”"
              className="border rounded-lg px-3 py-2 md:col-span-2"
              rows={3}
            />
            <div className="md:col-span-2 flex gap-3">
              <button
                type="submit"
                className="px-4 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-pink-500 text-white hover:scale-105 transition"
              >
                ×©××•×¨
              </button>
              <button
                type="button"
                onClick={() => setCreating(false)}
                className="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 transition"
              >
                ×‘×˜×œ
              </button>
            </div>
          </form>
        )}

        {loading ? (
          <p>×˜×•×¢×Ÿ ××©×¨×•×ªâ€¦</p>
        ) : jobs.length === 0 ? (
          <p>××™×Ÿ ××©×¨×•×ª ×¢×“×™×™×Ÿ.</p>
        ) : (
          <div className="grid gap-4">
            {jobs.map((job) => (
              <div
                key={job.id}
                className="bg-gradient-to-r from-green-400 to-blue-500 rounded-xl shadow p-5 flex flex-col md:flex-row md:items-center md:justify-between"
              >
                <div>
                  <h3 className="text-xl font-semibold text-gray-800">{job.title}</h3>
                  <p className="text-gray-500 mt-1">
                    {job.work_location || "â€”"} Â· {job.employment_type || "â€”"} Â·{" "}
                    {job.required_experience != null ? `${job.required_experience}y exp` : "× ×™×¡×™×•×Ÿ ×œ× ×¦×•×™×Ÿ"}
                  </p>
                  {job.required_technologies && (
                    <p className="text-gray-600 mt-2">
                      ×˜×›× ×•×œ×•×’×™×•×ª: {job.required_technologies}
                    </p>
                  )}
                </div>
                <div className="flex gap-3 mt-4 md:mt-0">
                  <button
                    onClick={() => toggleOpen(job)}
                    className={`px-3 py-1.5 rounded-lg text-white ${
                      job.is_open ? "bg-emerald-600" : "bg-slate-500"
                    }`}
                  >
                    {job.is_open ? "×¤×ª×•×—×”" : "×¡×’×•×¨×”"}
                  </button>
                  <button
                    onClick={() => deleteJob(job.id)}
                    className="px-3 py-1.5 rounded-lg bg-red-600 text-white"
                  >
                    ××—×§
                  </button>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}
--- END: FrontEnd/src/pages/jobs.jsx ---

--- START: FrontEnd/src/components/Navbar.jsx ---
// ğŸ“ src/components/Navbar.jsx
import { NavLink } from "react-router-dom";
import { useAuth } from "../context/AuthContext.jsx";
import { useState } from "react";
import { Menu, X } from "lucide-react";

export default function Navbar() {
  const { user, logout } = useAuth();
  const [open, setOpen] = useState(false);

  const linkClass = ({ isActive }) =>
    `transition-colors hover:text-yellow-300 ${
      isActive ? "font-bold underline underline-offset-4" : ""
    }`;

  return (
    <header className="bg-gradient-to-r from-purple-600 to-pink-500 shadow-lg sticky top-0 z-50">
      <nav className="max-w-6xl mx-auto flex items-center justify-between px-6 py-3">
        {/* ×œ×•×’×• */}
        <NavLink
          to="/"
          className="text-3xl font-extrabold text-white tracking-wide hover:scale-105 transition-transform"
        >
          DevSecJobs
        </NavLink>

        {/* ×ª×¤×¨×™×˜ ×“×¡×§×˜×•×¤ */}
        <div className="hidden md:flex gap-6 items-center">
          {!user && (
            <>
              <NavLink
                to="/"
                className="px-5 py-2 rounded-lg text-white font-medium hover:bg-white/20 transition-all"
              >
                Home
              </NavLink>
              <NavLink
                to="/login"
                className="px-5 py-2 rounded-lg text-white font-medium hover:bg-white/20 transition-all"
              >
                Login
              </NavLink>
              <NavLink
                to="/register"
                className="px-5 py-2 rounded-lg bg-purple-600 text-white font-semibold shadow hover:shadow-md hover:scale-105 transition"
              >
                Sign Up
              </NavLink>
            </>
          )}

          {user && (
            <>
              <NavLink
                to={user.is_admin ? "/dashboard" : "/user-home"}
                className={linkClass}
              >
                Home
              </NavLink>
              <button
                onClick={logout}
                className="ml-4 text-white hover:text-red-300"
              >
                Logout
              </button>
              <span className="ml-2 text-white">ğŸ‘¤</span>
            </>
          )}
        </div>

        {/* ×ª×¤×¨×™×˜ ××•×‘×™×™×œ */}
        <button
          className="md:hidden text-white"
          onClick={() => setOpen(!open)}
        >
          {open ? <X /> : <Menu />}
        </button>
      </nav>

      {/* ×ª×¤×¨×™×˜ ××•×‘×™×™×œ × ×¤×ª×— */}
      {open && (
        <div className="md:hidden flex flex-col gap-4 bg-white/95 text-gray-900 px-6 py-4">
          {!user && (
            <>
              <NavLink
                to="/"
                className={linkClass}
                onClick={() => setOpen(false)}
              >
                Home
              </NavLink>
              <NavLink
                to="/login"
                className={linkClass}
                onClick={() => setOpen(false)}
              >
                Login
              </NavLink>
              <NavLink
                to="/register"
                className="px-4 py-1.5 bg-pink-600 text-white rounded-full"
                onClick={() => setOpen(false)}
              >
                Sign Up
              </NavLink>
            </>
          )}

          {user && (
            <>
              <NavLink
                to={user.is_admin ? "/dashboard" : "/user-home"}
                className={linkClass}
                onClick={() => setOpen(false)}
              >
                Home
              </NavLink>
              <button
                onClick={() => {
                  logout();
                  setOpen(false);
                }}
              >
                Logout
              </button>
            </>
          )}
        </div>
      )}
    </header>
  );
}
--- END: FrontEnd/src/components/Navbar.jsx ---

--- START: FrontEnd/src/components/ProtectedRoute.jsx ---
// ğŸ“ src/components/ProtectedRoute.jsx
import { Navigate } from "react-router-dom";
import { useAuth } from "../context/AuthContext.jsx";

export default function ProtectedRoute({ children, adminOnly = false }) {
  const { user, loading } = useAuth();

  // ××¦×‘ ×˜×¢×™× ×” â€“ ×œ× × ×¦×™×’ ×›×œ×•× ×¢×“ ×©× ×¡×™×™× ×œ×‘×“×•×§ ×× ×™×© ××©×ª××©
  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen text-gray-600">
        ×˜×•×¢×Ÿ...
      </div>
    );
  }

  // ×× ××™×Ÿ ××©×ª××© ××—×•×‘×¨ â†’ × ×©×œ×— ××•×ª×• ×œ-login
  if (!user) {
    return <Navigate to="/login" replace />;
  }

  // ×× × ×“×¨×© ××“××™×Ÿ ××‘×œ ×”××©×ª××© ×œ× ××“××™×Ÿ â†’ ×©×•×œ×—×™× ××•×ª×• ×œ-home
  if (adminOnly && !user.is_admin) {
    return <Navigate to="/user-home" replace />;
  }

  // ××—×¨×ª â€“ ××¦×™×’×™× ××ª ×”××¡×š ×”××§×•×¨×™
  return children;
}
--- END: FrontEnd/src/components/ProtectedRoute.jsx ---

--- START: Devops/k8s/namespace.yaml ---
kind: Namespace
apiVersion: v1
metadata:
  name: devsecjobs
--- END: Devops/k8s/namespace.yaml ---

--- START: Devops/k8s/MySQL/deployment.yaml ---
kind: Deployment
apiVersion: apps/v1
metadata:
  name: mysql-deployment
  namespace: devsecjobs
  labels:
    app: mysql
spec:
  replicas: 1

  strategy:
    type: Recreate

  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
        - name: mysql
          image: 455715798206.dkr.ecr.us-east-1.amazonaws.com/devsecjobs-mysql:8.0
          ports:
            - containerPort: 3306
          env:
            - name: MYSQL_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: db-credentials
                  key: MYSQL_ROOT_PASSWORD
            - name: MYSQL_DATABASE
              valueFrom:
                secretKeyRef:
                  name: db-credentials
                  key: MYSQL_DATABASE
            - name: MYSQL_USER
              valueFrom:
                secretKeyRef:
                  name: db-credentials
                  key: MYSQL_USER
            - name: MYSQL_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: db-credentials
                  key: MYSQL_PASSWORD
            - name: MYSQLD_ARGS
              value: "--innodb_force_recovery=4"
          volumeMounts:
            - name: mysql-pvc
              mountPath: /var/lib/mysql
          livenessProbe:
            exec:
              command: ["sh", "-c", "mysqladmin ping -h 127.0.0.1 -p$MYSQL_ROOT_PASSWORD"]
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            exec:
              command: ["sh", "-c", "mysqladmin ping -h 127.0.0.1 -p$MYSQL_ROOT_PASSWORD"]
            initialDelaySeconds: 15
            periodSeconds: 5
          resources:
            requests:
              memory: "512Mi"
              cpu: "500m"
            limits:
              memory: "1Gi"
              cpu: "1"
      volumes:
        - name: mysql-pvc
          persistentVolumeClaim:
            claimName: mysql-pvc
--- END: Devops/k8s/MySQL/deployment.yaml ---

--- START: Devops/k8s/MySQL/pdb.yaml ---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: db-pdb
  namespace: devsecjobs
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: mysql
--- END: Devops/k8s/MySQL/pdb.yaml ---

--- START: Devops/k8s/MySQL/pvc.yaml ---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-pvc
  namespace: devsecjobs
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: gp2  
  resources:
    requests:
      storage: 20Gi
  
--- END: Devops/k8s/MySQL/pvc.yaml ---

--- START: Devops/k8s/MySQL/service.yaml ---
apiVersion: v1
kind: Service
metadata:
  name: mysql-service
  namespace: devsecjobs
spec:
  selector:
    app: mysql
  ports:
    - protocol: TCP
      port: 3306
      targetPort: 3306
  type: ClusterIP
--- END: Devops/k8s/MySQL/service.yaml ---

--- START: Devops/k8s/Ingress/ingress.yaml ---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: devsecjobs-ingress
  namespace: devsecjobs
  annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP":80}]'
spec:
  rules:
  - http:
      paths:
      - path: /auth
        pathType: Prefix
        backend:
          service:
            name: backend-service
            port:
              number: 5001

      - path: /jobs
        pathType: Prefix
        backend:
          service:
            name: backend-service
            port:
              number: 5001

      - path: /apply
        pathType: Prefix
        backend:
          service:
            name: backend-service
            port:
              number: 5001

      - path: /applicants
        pathType: Prefix
        backend:
          service:
            name: backend-service
            port:
              number: 5001

      - path: /health
        pathType: Prefix
        backend:
          service:
            name: backend-service
            port:
              number: 5001

      # Frontend last
      - path: /
        pathType: Prefix
        backend:
          service:
            name: frontend-service
            port:
              number: 80
--- END: Devops/k8s/Ingress/ingress.yaml ---

--- START: Devops/k8s/Map_Secrets/configmaps.yaml ---
kind: ConfigMap
apiVersion: v1
metadata:
  name: backend-config
  namespace: devsecjobs
data:
  FLASK_ENV: "production"
  FLASK_DEBUG: "0"
  PORT: "5001"
  JWT_ACCESS_EXPIRES_MIN: "60"
  JWT_REFRESH_EXPIRES_DAYS: "7"
  CORS_ORIGINS: "*"

---
kind: ConfigMap
apiVersion: v1
metadata:
  name: frontend-config
  namespace: devsecjobs
data:
  VITE_API_BASE_URL: "http://backend-service:5001"

--- END: Devops/k8s/Map_Secrets/configmaps.yaml ---

--- START: Devops/k8s/Map_Secrets/secrets.yaml ---
kind: Secret
apiVersion: v1
metadata:
  name: db-credentials
  namespace: devsecjobs
type: Opaque
stringData:
  MYSQL_ROOT_PASSWORD: "rootStrongPass123"
  MYSQL_DATABASE: "devsecjobs"
  MYSQL_USER: "devsecjobs_user"
  MYSQL_PASSWORD: "devsecjobs_pass"

  DB_HOST: "mysql-service"
  DB_NAME: "devsecjobs"
  DB_USER: "devsecjobs_user"
  DB_PASSWORD: "devsecjobs_pass"
---
kind: Secret
apiVersion: v1
metadata:
  name: jwt-secret
  namespace: devsecjobs
type: Opaque
data:
  JWT_SECRET_KEY: c2VjdXJlX2tleV9mb3Jfand0 # secure_key_for_jwt  
--- END: Devops/k8s/Map_Secrets/secrets.yaml ---

--- START: Devops/k8s/Frontend/deployment.yaml ---
kind: Deployment
apiVersion: apps/v1
metadata:
  name: frontend-deployment
  namespace: devsecjobs
  labels:
    app: frontend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: frontend
  template:
    metadata:
      labels:
        app: frontend
    spec:
      containers:
        - name: frontend
          image: 455715798206.dkr.ecr.us-east-1.amazonaws.com/devsecjobs-frontend:v39


          imagePullPolicy: Always
          ports:
            - containerPort: 80
          envFrom:
            - configMapRef:
                name: frontend-config
          livenessProbe:
            httpGet:
              path: /
              port: 80
            initialDelaySeconds: 10
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /
              port: 80
            initialDelaySeconds: 5
            periodSeconds: 10
          resources:
            requests:
              memory: "128Mi"
              cpu: "100m"
            limits:
              memory: "256Mi"
              cpu: "200m"
--- END: Devops/k8s/Frontend/deployment.yaml ---

--- START: Devops/k8s/Frontend/pdb.yaml ---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: frontend-pdb
  namespace: devsecjobs
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: frontend
--- END: Devops/k8s/Frontend/pdb.yaml ---

--- START: Devops/k8s/Frontend/service.yaml ---
kind: Service
apiVersion: v1
metadata:
  name: frontend-service
  namespace: devsecjobs
spec:
  selector:
    app: frontend
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
  type: ClusterIP
--- END: Devops/k8s/Frontend/service.yaml ---

--- START: Devops/k8s/Backend/deployment.yaml ---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-deployment
  namespace: devsecjobs
  labels:
    app: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
    spec:

      initContainers:
        - name: wait-for-mysql
          image: busybox:1.36
          command:
            - sh
            - -c
            - |
              echo "Waiting for MySQL DNS..."
              until nslookup mysql-service.devsecjobs.svc.cluster.local >/dev/null 2>&1; do
                echo "DNS not ready yet..."; sleep 2;
              done

              echo "Waiting for MySQL port 3306..."
              until nc -z mysql-service.devsecjobs.svc.cluster.local 3306; do
                echo "MySQL not ready yet..."; sleep 2;
              done

              echo "MySQL is up!"

      containers:
        - name: backend
          image: 455715798206.dkr.ecr.us-east-1.amazonaws.com/devsecjobs-backend:v2
          ports:
            - containerPort: 5001

          envFrom:
            - configMapRef:
                name: backend-config
            - secretRef:
                name: db-credentials
            - secretRef:
                name: jwt-secret

          env:
            - name: DATABASE_URL
              value: "mysql+pymysql://$(DB_USER):$(DB_PASSWORD)@$(DB_HOST):3306/$(DB_NAME)?charset=utf8mb4"

          livenessProbe:
            httpGet:
              path: /health
              port: 5001
            initialDelaySeconds: 20
            periodSeconds: 20

          readinessProbe:
            httpGet:
              path: /health
              port: 5001
            initialDelaySeconds: 10
            periodSeconds: 10

          resources:
            requests:
              memory: "256Mi"
              cpu: "250m"
            limits:
              memory: "512Mi"
              cpu: "500m"
--- END: Devops/k8s/Backend/deployment.yaml ---

--- START: Devops/k8s/Backend/pdb.yaml ---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: backend-pdb
  namespace: devsecjobs
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: backend
--- END: Devops/k8s/Backend/pdb.yaml ---

--- START: Devops/k8s/Backend/service.yaml ---
kind: Service
apiVersion: v1
metadata:
  name: backend-service
  namespace: devsecjobs
spec:
  selector:
    app: backend
  ports:
    - protocol: TCP
      port: 5001
      targetPort: 5001
  type: ClusterIP
--- END: Devops/k8s/Backend/service.yaml ---

--- START: Devops/tf/jenkins/ec2.tf ---
data "aws_ami" "ubuntu" {
  most_recent = true
  owners      = ["099720109477"]

  filter {
    name   = "name"
    values = ["ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"]
  }
}

locals {
  user_data = <<-EOF
  #!/bin/bash
  set -eux

  apt-get update -y
  apt-get install -y git curl unzip ca-certificates gnupg lsb-release

  # Docker
  curl -fsSL https://get.docker.com | sh
  usermod -aG docker jenkins || true

  # Jenkins
  curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key \
    | tee /usr/share/keyrings/jenkins-keyring.asc > /dev/null
  echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \
    https://pkg.jenkins.io/debian-stable binary/ \
    > /etc/apt/sources.list.d/jenkins.list

  apt-get update -y
  apt-get install -y openjdk-17-jre jenkins
  systemctl enable --now jenkins

  # AWS CLI
  curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o aws.zip
  unzip -q aws.zip && ./aws/install

  # kubectl
  curl -LO https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl
  install -m 0755 kubectl /usr/local/bin/kubectl
  EOF
}

resource "aws_instance" "jenkins" {
  ami                         = data.aws_ami.ubuntu.id
  instance_type               = var.instance_type
  subnet_id                   = local.public_subnet_id
  vpc_security_group_ids      = [aws_security_group.jenkins_sg.id]
  key_name                    = var.key_name
  iam_instance_profile        = aws_iam_instance_profile.jenkins.name
  associate_public_ip_address = true
  user_data                   = local.user_data

  tags = { Name = "jenkins-trusted-ec2" }
  lifecycle {
    prevent_destroy = true
  }
  
  
}
--- END: Devops/tf/jenkins/ec2.tf ---

--- START: Devops/tf/jenkins/iam.tf ---
data "aws_iam_policy_document" "assume_ec2" {
  statement {
    effect = "Allow"
    principals {
      type        = "Service"
      identifiers = ["ec2.amazonaws.com"]
    }
    actions = ["sts:AssumeRole"]
  }
}

resource "aws_iam_role" "jenkins_role" {
  name               = "jenkins-ec2-role"
  assume_role_policy = data.aws_iam_policy_document.assume_ec2.json
}

resource "aws_iam_role_policy_attachment" "ecr" {
  role       = aws_iam_role.jenkins_role.name
  policy_arn = "arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryPowerUser"
}

resource "aws_iam_role_policy_attachment" "eks" {
  role       = aws_iam_role.jenkins_role.name
  policy_arn = "arn:aws:iam::aws:policy/AmazonEKSClusterPolicy"
}

resource "aws_iam_role_policy_attachment" "eks_worker" {
  role       = aws_iam_role.jenkins_role.name
  policy_arn = "arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy"
}

resource "aws_iam_instance_profile" "jenkins" {
  name = "jenkins-ec2-profile"
  role = aws_iam_role.jenkins_role.name
}
--- END: Devops/tf/jenkins/iam.tf ---

--- START: Devops/tf/jenkins/outputs.tf ---
output "jenkins_public_ip" {
  value = aws_instance.jenkins.public_ip
}
output "jenkins_sg_id" {
  value = aws_security_group.jenkins_sg.id
}
--- END: Devops/tf/jenkins/outputs.tf ---

--- START: Devops/tf/jenkins/providers.tf ---
terraform {
  required_version = ">= 1.5.0"

  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
    http = {
      source  = "hashicorp/http"
      version = "~> 3.0"
    }
  }
}

provider "aws" {
  region = var.aws_region
}
--- END: Devops/tf/jenkins/providers.tf ---

--- START: Devops/tf/jenkins/remote_state.tf ---
data "terraform_remote_state" "eks" {
  backend = "local"
  config = {
    path = "../eks/terraform.tfstate"
  }
}

data "http" "my_ip" {
  url = "https://checkip.amazonaws.com"
}

locals {
  vpc_id           = data.terraform_remote_state.eks.outputs.vpc_id
  public_subnet_id = data.terraform_remote_state.eks.outputs.public_subnet_ids[0]
  cluster_name     = data.terraform_remote_state.eks.outputs.eks_cluster_name

  my_ip_cidr = "${chomp(data.http.my_ip.response_body)}/32"
  ssh_cidrs = distinct(concat(
    var.allowed_ssh_cidrs,
    [local.my_ip_cidr]
  ))
  jenkins_cidrs = distinct(concat(
    var.allowed_jenkins_cidrs,
    [local.my_ip_cidr]
  ))
}
--- END: Devops/tf/jenkins/remote_state.tf ---

--- START: Devops/tf/jenkins/security.tf ---
resource "aws_security_group" "jenkins_sg" {
  name   = "jenkins-ec2-sg"
  vpc_id = local.vpc_id

  # SSH - ×ª××™×“ tight
  ingress {
    description = "SSH"
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = local.ssh_cidrs
  }

  ingress {
    description = "Jenkins UI"
    from_port   = 8080
    to_port     = 8080
    protocol    = "tcp"
    cidr_blocks = local.jenkins_cidrs
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}
--- END: Devops/tf/jenkins/security.tf ---

--- START: Devops/tf/jenkins/variables.tf ---
variable "key_name" {
  description = "The name of the SSH key pair"
  type        = string
  default     = "jenkins-key"
}
variable "instance_type" {
  description = "The type of instance to use for Jenkins"
  type        = string
  default     = "t3.medium"
}
variable "aws_region" {
  description = "The AWS region to deploy Jenkins"
  type        = string
  default     = "us-east-1"
}
variable "allowed_ssh_cidrs" {
  description = "List of allowed SSH CIDR blocks"
  type        = list(string)
  default     = []
}
variable "allowed_jenkins_cidrs" {
  description = "List of allowed Jenkins CIDR blocks"
  type        = list(string)
  default     = []
}
--- END: Devops/tf/jenkins/variables.tf ---

--- START: Devops/tf/eks/addons.tf ---
#########################################################
# Optional EKS Add-ons (CNI, CoreDNS, kube-proxy)
#########################################################

resource "aws_eks_addon" "vpc_cni" {
  cluster_name                = aws_eks_cluster.eks_cluster.name
  addon_name                  = "vpc-cni"
  resolve_conflicts_on_create = "OVERWRITE"
  resolve_conflicts_on_update = "OVERWRITE"
}
resource "aws_eks_addon" "core_dns" {
  cluster_name                = aws_eks_cluster.eks_cluster.name
  addon_name                  = "coredns"
  resolve_conflicts_on_create = "OVERWRITE"
  resolve_conflicts_on_update = "OVERWRITE"
}
resource "aws_eks_addon" "kube_proxy" {
  cluster_name                = aws_eks_cluster.eks_cluster.name
  addon_name                  = "kube-proxy"
  resolve_conflicts_on_create = "OVERWRITE"
  resolve_conflicts_on_update = "OVERWRITE"
}
resource "aws_eks_addon" "ebs_csi" {
  cluster_name                = aws_eks_cluster.eks_cluster.name
  addon_name                  = "aws-ebs-csi-driver"

  resolve_conflicts_on_create = "OVERWRITE"
  resolve_conflicts_on_update = "OVERWRITE"
  
  lifecycle {
    ignore_changes = [
      resolve_conflicts_on_create,
      resolve_conflicts_on_update,
    ]
  }
}

--- END: Devops/tf/eks/addons.tf ---

--- START: Devops/tf/eks/alb_helm.tf ---
resource "helm_release" "aws_load_balancer_controller" {
  name       = "aws-load-balancer-controller"
  repository = "https://aws.github.io/eks-charts"
  chart      = "aws-load-balancer-controller"
  namespace  = "kube-system"

  # ××ª×” ×›×‘×¨ ×™×•×¦×¨ SA ×¢× IRSA (alb_sa.tf), ××– ×œ× ×œ×ª×ª ×œ-Helm ×œ×™×¦×•×¨ ××—×“ ×—×“×©
  set {
    name  = "serviceAccount.create"
    value = "false"
  }
  set {
    name  = "serviceAccount.name"
    value = "aws-load-balancer-controller"
  }

  set {
    name  = "clusterName"
    value = aws_eks_cluster.eks_cluster.name
  }

  # ××•××œ×¥ ×›×“×™ ×œ×× ×•×¢ autodiscovery ××•×–×¨
  set {
    name  = "region"
    value = var.aws_region
  }
  set {
    name  = "vpcId"
    value = aws_vpc.eks_vpc.id
  }

  depends_on = [
    module.alb_controller_irsa,
    kubernetes_service_account.alb_controller
  ]
}
--- END: Devops/tf/eks/alb_helm.tf ---

--- START: Devops/tf/eks/alb_irsa.tf ---
module "alb_controller_irsa" {
  source  = "terraform-aws-modules/iam/aws//modules/iam-role-for-service-accounts-eks"
  version = "~> 5.0"

  role_name = "alb-controller-irsa"

  attach_load_balancer_controller_policy = true

  oidc_providers = {
    eks = {
      provider_arn = aws_iam_openid_connect_provider.eks.arn
      namespace_service_accounts = [
        "kube-system:aws-load-balancer-controller"
      ]
    }
  }
}
--- END: Devops/tf/eks/alb_irsa.tf ---

--- START: Devops/tf/eks/alb_sa.tf ---
resource "kubernetes_service_account" "alb_controller" {
  metadata {
    name      = "aws-load-balancer-controller"
    namespace = "kube-system"

    annotations = {
      "eks.amazonaws.com/role-arn" = module.alb_controller_irsa.iam_role_arn
    }
  }
}
--- END: Devops/tf/eks/alb_sa.tf ---

--- START: Devops/tf/eks/ecr.tf ---
locals {
  repos = [
    "${var.project_name}-frontend",
    "${var.project_name}-backend",
    "${var.project_name}-mysql"
  ]
}

resource "aws_ecr_repository" "repos" {
  for_each = toset(local.repos)

  name                 = each.value
  image_tag_mutability = "IMMUTABLE" # ××•××œ×¥! ×›×œ push ×—×™×™×‘ ×ª×’ ×—×“×© (v1,v2 ×•×›×•')
  force_delete         = true        # × ×•×— ×‘×¡×‘×™×‘×ª ×œ×™××•×“ (××¤×©×¨ ×œ×©× ×•×ª ×œ-false ×‘×¤×¨×•×“×§×©×Ÿ)

  image_scanning_configuration {
    scan_on_push = true
  }
}

# ××•×—×§ ××™××’'×™× ×™×©× ×™× ×›×“×™ ×œ× ×œ× ×¤×— ×¢×œ×•×™×•×ª/×œ×›×œ×•×š
resource "aws_ecr_lifecycle_policy" "repos" {
  for_each   = aws_ecr_repository.repos
  repository = each.value.name

  policy = jsonencode({
    rules = [
      {
        rulePriority = 1
        description  = "Keep last 15 images"
        selection = {
          tagStatus   = "any"
          countType   = "imageCountMoreThan"
          countNumber = 15
        }
        action = {
          type = "expire"
        }
      }
    ]
  })
}

output "ecr_repo_urls" {
  value = { for k, r in aws_ecr_repository.repos : k => r.repository_url }
}
--- END: Devops/tf/eks/ecr.tf ---

--- START: Devops/tf/eks/eks.tf ---
#########################################################
# EKS Cluster and Node Group
#########################################################

# Data sources for existing subnets (public/private)
locals {
  public_subnet_ids  = [for s in aws_subnet.public : s.id]
  private_subnet_ids = [for s in aws_subnet.private : s.id]
  all_subnet_ids     = concat(local.public_subnet_ids, local.private_subnet_ids)
}


# IAM Role for EKS Cluster
resource "aws_iam_role" "eks_cluster_role" {
  name = "${var.cluster_name}-cluster-role"

  assume_role_policy = jsonencode({
    Version = "2012-10-17",
    Statement = [
      {
        Effect    = "Allow",
        Principal = { Service = "eks.amazonaws.com" },
        Action    = "sts:AssumeRole"
      }
    ]
  })
}

resource "aws_iam_role_policy_attachment" "eks_cluster_attach" {
  policy_arn = "arn:aws:iam::aws:policy/AmazonEKSClusterPolicy"
  role       = aws_iam_role.eks_cluster_role.name
}

# IAM Role for EKS Node Group
resource "aws_iam_role" "eks_node_role" {
  name = "${var.cluster_name}-node-role"

  assume_role_policy = jsonencode({
    Version = "2012-10-17",
    Statement = [
      {
        Effect    = "Allow",
        Principal = { Service = "ec2.amazonaws.com" },
        Action    = "sts:AssumeRole"
      }
    ]
  })
}

resource "aws_iam_role_policy_attachment" "eks_worker_attach" {
  role       = aws_iam_role.eks_node_role.name
  policy_arn = "arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy"
}

resource "aws_iam_role_policy_attachment" "eks_cni_attach" {
  role       = aws_iam_role.eks_node_role.name
  policy_arn = "arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy"
}

resource "aws_iam_role_policy_attachment" "eks_registry_attach" {
  role       = aws_iam_role.eks_node_role.name
  policy_arn = "arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly"
}
resource "aws_iam_role_policy_attachment" "eks_ebs_csi_attach" {
  role       = aws_iam_role.eks_node_role.name
  policy_arn = "arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy"
}

# EKS Cluster
resource "aws_eks_cluster" "eks_cluster" {
  name     = var.cluster_name
  role_arn = aws_iam_role.eks_cluster_role.arn
  version  = var.k8s_version

  vpc_config {
    subnet_ids              = local.all_subnet_ids
    endpoint_private_access = true
    endpoint_public_access  = true
  }



  depends_on = [
    aws_iam_role_policy_attachment.eks_cluster_attach
  ]
}

# EKS Node Group
resource "aws_eks_node_group" "eks_nodes" {
  cluster_name    = aws_eks_cluster.eks_cluster.name
  node_group_name = "${var.cluster_name}-nodes"
  node_role_arn   = aws_iam_role.eks_node_role.arn
  subnet_ids      = local.private_subnet_ids

  scaling_config {
    desired_size = 2
    min_size     = 2
    max_size     = 4
  }

  instance_types = [var.node_instance_type]

  remote_access {
    ec2_ssh_key = var.ssh_key_name
  }

  depends_on = [
    aws_iam_role_policy_attachment.eks_worker_attach,
    aws_iam_role_policy_attachment.eks_cni_attach,
    aws_iam_role_policy_attachment.eks_registry_attach,
    aws_iam_role_policy_attachment.eks_ebs_csi_attach
  ]
}

resource "aws_security_group_rule" "jenkins_to_eks" {
  type                     = "ingress"
  security_group_id = aws_eks_cluster.eks_cluster.vpc_config[0].cluster_security_group_id
  from_port                = 443
  to_port                  = 443
  protocol                 = "tcp"
  source_security_group_id = data.terraform_remote_state.jenkins.outputs.jenkins_sg_id
  description              = "Allow Jenkins to communicate with EKS cluster"
  
}
--- END: Devops/tf/eks/eks.tf ---

--- START: Devops/tf/eks/k8s_providers.tf ---
data "aws_eks_cluster" "this" {
  name = aws_eks_cluster.eks_cluster.name
}

data "aws_eks_cluster_auth" "this" {
  name = aws_eks_cluster.eks_cluster.name
}

provider "kubernetes" {
  host                   = data.aws_eks_cluster.this.endpoint
  cluster_ca_certificate = base64decode(data.aws_eks_cluster.this.certificate_authority[0].data)
  token                  = data.aws_eks_cluster_auth.this.token
}

provider "helm" {
  kubernetes {
    host                   = data.aws_eks_cluster.this.endpoint
    cluster_ca_certificate = base64decode(data.aws_eks_cluster.this.certificate_authority[0].data)
    token                  = data.aws_eks_cluster_auth.this.token
  }
}
--- END: Devops/tf/eks/k8s_providers.tf ---

--- START: Devops/tf/eks/oidc.tf ---
data "tls_certificate" "eks_oidc" {
  url = aws_eks_cluster.eks_cluster.identity[0].oidc[0].issuer
}

resource "aws_iam_openid_connect_provider" "eks" {
  url             = aws_eks_cluster.eks_cluster.identity[0].oidc[0].issuer
  client_id_list  = ["sts.amazonaws.com"]
  thumbprint_list = [data.tls_certificate.eks_oidc.certificates[0].sha1_fingerprint]
}
--- END: Devops/tf/eks/oidc.tf ---

--- START: Devops/tf/eks/outputs.tf ---
output "eks_cluster_name" {
  value       = aws_eks_cluster.eks_cluster.name
  description = "The name of the EKS cluster"
}

output "eks_cluster_endpoint" {
  value       = aws_eks_cluster.eks_cluster.endpoint
  description = "The endpoint of the EKS cluster"
}

output "eks_cluster_arn" {
  value       = aws_eks_cluster.eks_cluster.arn
  description = "The ARN of the EKS cluster"
}

output "eks_node_group_name" {
  value       = aws_eks_node_group.eks_nodes.node_group_name
  description = "The name of the Node Group"
}

output "eks_node_role_arn" {
  value       = aws_iam_role.eks_node_role.arn
  description = "The IAM Role ARN of the Node Group"
}
output "vpc_id" {
  value       = aws_vpc.eks_vpc.id
  description = "The ID of the VPC where EKS cluster is deployed"
}
output "public_subnet_ids" {
  value       = aws_subnet.public[*].id
  description = "The IDs of the subnets used by the EKS cluster"
}
output "private_subnet_ids" {
  value       = aws_subnet.private[*].id
  description = "The IDs of the private subnets used by the EKS cluster"
}
--- END: Devops/tf/eks/outputs.tf ---

--- START: Devops/tf/eks/providers.tf ---
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
    tls = {
      source  = "hashicorp/tls"
      version = "~> 4.0"
    }
    kubernetes = {
      source  = "hashicorp/kubernetes"
      version = "~> 2.30"
    }
    helm = {
      source  = "hashicorp/helm"
      version = "~> 2.14"
    }
  }
}

provider "aws" {
  region = var.aws_region
}
--- END: Devops/tf/eks/providers.tf ---

--- START: Devops/tf/eks/remote_state.tf ---
data "terraform_remote_state" "jenkins" {
  backend = "local"
  config = {
    path = "../jenkins/terraform.tfstate"
  }
}
--- END: Devops/tf/eks/remote_state.tf ---

--- START: Devops/tf/eks/variables.tf ---
variable "aws_region" {
  description = "The AWS region to deploy resources in"
  type        = string
  default     = "us-east-1"
}
variable "cluster_name" {
  description = "The name of the EKS cluster"
  type        = string
  default     = "devsecjobs-eks"
}
variable "k8s_version" {
  description = "The Kubernetes version for the EKS cluster"
  type        = string
  default     = "1.29"
}
variable "node_instance_type" {
  description = "The instance type for the EKS worker nodes"
  type        = string
  default     = "t3.medium"
}
variable "project_name" {
  description = "The name of the project"
  type        = string
  default     = "devsecjobs"
}
variable "ssh_key_name" {
  description = "The name of the SSH key pair for EC2 instances"
  type        = string
  default     = "Nery-Pair"
}
--- END: Devops/tf/eks/variables.tf ---

--- START: Devops/tf/eks/vpc.tf ---
resource "aws_vpc" "eks_vpc" {
  cidr_block           = "10.0.0.0/16"
  enable_dns_hostnames = true
  enable_dns_support   = true

  tags = {
    Name = "${var.cluster_name}-vpc"
  }
}

# Public subnets (×œÖ¾ALB)
resource "aws_subnet" "public" {
  count                   = 2
  vpc_id                  = aws_vpc.eks_vpc.id
  cidr_block              = cidrsubnet(aws_vpc.eks_vpc.cidr_block, 4, count.index)
  availability_zone       = data.aws_availability_zones.available.names[count.index]
  map_public_ip_on_launch = true

  tags = {
    Name                                        = "${var.cluster_name}-public-${count.index + 1}"
    "kubernetes.io/role/elb"                    = "1"
    "kubernetes.io/cluster/${var.cluster_name}" = "shared"
  }
}

# Private subnets (×œÖ¾EKS nodes)
resource "aws_subnet" "private" {
  count             = 2
  vpc_id            = aws_vpc.eks_vpc.id
  cidr_block        = cidrsubnet(aws_vpc.eks_vpc.cidr_block, 4, count.index + 2)
  availability_zone = data.aws_availability_zones.available.names[count.index]

  tags = {
    Name                                        = "${var.cluster_name}-private-${count.index + 1}"
    "kubernetes.io/role/internal-elb"           = "1"
    "kubernetes.io/cluster/${var.cluster_name}" = "shared"
  }
}

# Internet Gateway
resource "aws_internet_gateway" "igw" {
  vpc_id = aws_vpc.eks_vpc.id

  tags = {
    Name = "${var.cluster_name}-igw"
  }
}

resource "aws_eip" "nat" {
  domain = "vpc"
}

resource "aws_nat_gateway" "nat_gw" {
  allocation_id = aws_eip.nat.id
  subnet_id     = aws_subnet.public[0].id

  tags = {
    Name = "${var.cluster_name}-nat"
  }
}

# Route Tables
resource "aws_route_table" "public" {
  vpc_id = aws_vpc.eks_vpc.id

  route {
    cidr_block = "0.0.0.0/0"
    gateway_id = aws_internet_gateway.igw.id
  }

  tags = {
    Name = "${var.cluster_name}-public-rt"
  }
}

resource "aws_route_table_association" "public_assoc" {
  count          = length(aws_subnet.public)
  subnet_id      = aws_subnet.public[count.index].id
  route_table_id = aws_route_table.public.id
}

resource "aws_route_table" "private" {
  vpc_id = aws_vpc.eks_vpc.id

  route {
    cidr_block     = "0.0.0.0/0"
    nat_gateway_id = aws_nat_gateway.nat_gw.id
  }

  tags = {
    Name = "${var.cluster_name}-private-rt"
  }
}

resource "aws_route_table_association" "private_assoc" {
  count          = length(aws_subnet.private)
  subnet_id      = aws_subnet.private[count.index].id
  route_table_id = aws_route_table.private.id
}

# Availability Zones Data
data "aws_availability_zones" "available" {}
--- END: Devops/tf/eks/vpc.tf ---

--- START: Backend/Dockerfile ---
FROM python:3.12-alpine
WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt


COPY . .

EXPOSE 5001
CMD ["python3", "main.py"]
--- END: Backend/Dockerfile ---

--- START: Backend/extensions.py ---
# extensions.py
from flask_sqlalchemy import SQLAlchemy

db = SQLAlchemy()
--- END: Backend/extensions.py ---

--- START: Backend/main.py ---
import os
from datetime import timedelta
import pymysql
from dotenv import load_dotenv
from flask import Flask
from flask_cors import CORS
from flask_jwt_extended import JWTManager
from sqlalchemy import inspect
from extensions import db

from Routers.job_router import jobs_bp
from Routers.applicant_router import applicants_bp
from Routers.application_router import apply_bp
from Routers.users_router import users_bp
from Routers.auth_router import auth_bp

from Models import Job, Applicant, Application, User  # noqa: F401


load_dotenv()


def bool_env(name: str, default: str = "0") -> bool:
    return os.getenv(name, default).strip().lower() in ("1", "true", "yes")


def int_env(name: str, default: str) -> int:
    try:
        return int(os.getenv(name, default))
    except ValueError:
        return int(default)


def mysql_uri() -> str:
    """
    Expected in .env:
    DATABASE_URL=mysql+pymysql://user:pass@host:3306/dbname?charset=utf8mb4
    """
    db_url = os.getenv("DATABASE_URL", "").strip()
    if not db_url:
        raise RuntimeError("DATABASE_URL is required (MySQL). Example: mysql+pymysql://user:pass@localhost:3306/db?charset=utf8mb4")

    if not db_url.startswith("mysql"):
        raise RuntimeError(f"DATABASE_URL must be a MySQL URL. Got: {db_url}")

    return db_url


def init_security_and_cors(app: Flask):
    jwt_secret = os.getenv("JWT_SECRET_KEY", "").strip()
    if not jwt_secret and os.getenv("FLASK_ENV", "development") != "development":
        raise RuntimeError("JWT_SECRET_KEY is required in non-development environments")

    app.config["JWT_SECRET_KEY"] = jwt_secret or "dev-only-super-secret"
    app.config["JWT_ACCESS_TOKEN_EXPIRES"] = timedelta(
        minutes=int_env("JWT_ACCESS_EXPIRES_MIN", "60")
    )
    app.config["JWT_REFRESH_TOKEN_EXPIRES"] = timedelta(
        days=int_env("JWT_REFRESH_EXPIRES_DAYS", "7")
    )
    app.config["JWT_TOKEN_LOCATION"] = ["headers"]
    app.config["JWT_ALGORITHM"] = "HS256"

    origins_raw = os.getenv("CORS_ORIGINS", "*").strip()
    if origins_raw == "*" or not origins_raw:
        origins = "*"
    else:
        origins = [o.strip() for o in origins_raw.split(",") if o.strip()]

    CORS(app, resources={r"/*": {"origins": origins}}, supports_credentials=False)

    jwt = JWTManager(app)

    @jwt.unauthorized_loader
    def unauthorized_loader(msg):
        return {"error": "Missing or invalid token", "detail": msg}, 401

    @jwt.invalid_token_loader
    def invalid_token_loader(msg):
        return {"error": "Invalid token", "detail": msg}, 422

    return jwt


def create_app() -> Flask:
    app = Flask(__name__, instance_relative_config=True)

    # âœ… MySQL instead of SQLite
    app.config["SQLALCHEMY_DATABASE_URI"] = mysql_uri()
    app.config["SQLALCHEMY_TRACK_MODIFICATIONS"] = False

    # âœ… recommended for MySQL connections
    app.config["SQLALCHEMY_ENGINE_OPTIONS"] = {
        "pool_pre_ping": True,
        "pool_recycle": 280,
    }

    db.init_app(app)

    init_security_and_cors(app)

    app.register_blueprint(jobs_bp, url_prefix="/jobs")
    app.register_blueprint(applicants_bp, url_prefix="/applicants")
    app.register_blueprint(apply_bp, url_prefix="/apply")
    app.register_blueprint(users_bp, url_prefix="/users")
    app.register_blueprint(auth_bp, url_prefix="/auth")

    with app.app_context():
        db.create_all()
        print(">>> Tables now:", inspect(db.engine).get_table_names())

    @app.get("/health")
    def health():
        return {"ok": True}, 200

    @app.route("/")
    def homepage():
        return "hello"

    return app


if __name__ == "__main__":
    app = create_app()
    debug = bool_env("FLASK_DEBUG", "0")
    port = int_env("PORT", "5001")
    app.run(host="0.0.0.0", debug=debug, port=port)
--- END: Backend/main.py ---

--- START: Backend/services/__init__.py ---

--- END: Backend/services/__init__.py ---

--- START: Backend/services/auth_utils.py ---
# auth_utils.py
from functools import wraps
from flask import jsonify
from flask_jwt_extended import verify_jwt_in_request, get_jwt

def admin_required(fn):
    """Decorator that ensures the requester is an admin."""
    @wraps(fn)
    def wrapper(*args, **kwargs):
        verify_jwt_in_request()
        claims = get_jwt()
        if not claims.get("is_admin", False):
            return jsonify({"error": "Admins only"}), 403
        return fn(*args, **kwargs)
    return wrapper
--- END: Backend/services/auth_utils.py ---

--- START: Backend/services/score_computing.py ---
# services/score_computing.py
from Models.applicant import Applicant
from Models.job import Job

def compute_application_score(applicant_id: int, job_id: int) -> int | None:

    applicant = Applicant.query.get(applicant_id)
    job = Job.query.get(job_id)

    if not applicant or not job:
        return None

    score = 0

    # × ×™×¡×™×•×Ÿ
    if applicant.years_experience and job.required_experience:
        if applicant.years_experience >= job.required_experience:
            score += 30
        else:
            score += (applicant.years_experience / job.required_experience) * 30

    # ×˜×›× ×•×œ×•×’×™×•×ª
    if applicant.technologies and job.required_technologies:
        applicant_techs = set(map(str.strip, applicant.technologies.split(',')))
        job_techs = set(map(str.strip, job.required_technologies.split(',')))
        if job_techs:
            matching_techs = applicant_techs.intersection(job_techs)
            score += (len(matching_techs) / len(job_techs)) * 50

    if applicant.education:
        if "PhD" in applicant.education:
            score += 20
        elif "Master" in applicant.education:
            score += 15
        elif "Bachelor" in applicant.education:
            score += 10

    return score
--- END: Backend/services/score_computing.py ---

--- START: Backend/Routers/__init__.py ---

--- END: Backend/Routers/__init__.py ---

--- START: Backend/Routers/applicant_router.py ---
from flask import Blueprint, request, jsonify

from Models import Application
from extensions import db
from Models.applicant import Applicant

applicants_bp = Blueprint("applicants", __name__)
@applicants_bp.get("/")
def applicants_list_jobs():
    rows = Applicant.query.order_by(Applicant.id.desc()).all()
    return jsonify([
        {
            "id": j.id,
            "name": j.name,
            "languages": j.languages,
            "technologies": j.technologies,
            "flagship_project": j.flagship_project,
            "last_job": j.last_job,
            "education": j.education,
            "years_experience": j.years_experience,
            "resume_path": j.resume_path
        } for j in rows
    ]), 200

@applicants_bp.route("/", methods=["POST"])
def create_applicant():
    data = request.get_json()
    if isinstance(data, list):
        applicants = []
        for item in data:
            if not item.get("name") or not item.get("resume_path"):
                return jsonify({"error": "Name and resume_path are required"}), 400
            applicant = Applicant(**item)
            applicants.append(applicant)
        db.session.add_all(applicants)
        db.session.commit()
        return jsonify([{"id": a.id, "name": a.name} for a in applicants]), 201
    else:
        if not data.get("name") or not data.get("resume_path"):
            return jsonify({"error": "Name and resume_path are required"}), 400
        applicant = Applicant(**data)
        db.session.add(applicant)
        db.session.commit()
        return jsonify({"id": applicant.id, "name": applicant.name}), 201



@applicants_bp.get("/by_applicant/<int:id>")
def get_applicant_by_id(id):
    applicant = Applicant.query.get(id)
    if not applicant:
        return jsonify({"error": "Applicant not found"}), 404

    return jsonify({
        "id": applicant.id,
        "name": applicant.name,
        "languages": applicant.languages,
        "technologies": applicant.technologies,
        "flagship_project": applicant.flagship_project,
        "last_job": applicant.last_job,
        "education": applicant.education,
        "years_experience": applicant.years_experience,
        "resume_path": applicant.resume_path
    }), 200

@applicants_bp.route("/<int:job_id>",methods=["GET"])
def getting_applicants_by_job_id(job_id):
    applications = Application.query.filter_by(job_id=job_id).all()
    if not applications:
        return jsonify({"error": "No applications found for this job"}), 404

    applicants_data = []
    for app in applications:
        applicant = Applicant.query.get(app.applicant_id)
        if applicant:
            applicants_data.append({
                "id": applicant.id,
                "name": applicant.name,
                "languages": applicant.languages,
                "technologies": applicant.technologies,
                "flagship_project": applicant.flagship_project,
                "last_job": applicant.last_job,
                "education": applicant.education,
                "years_experience": applicant.years_experience,
                "resume_path": applicant.resume_path,
                "application_status": app.status,
                "application_score": app.score
            })

    return jsonify(applicants_data), 200

@applicants_bp.get("/<int:job_id>/<int:applicant_id>")
def getting_applicant_details_and_score(job_id, applicant_id):
    application = Application.query.filter_by(job_id=job_id, applicant_id=applicant_id).first()
    if not application:
        return jsonify({"error": "Application not found"}), 404

    applicant = Applicant.query.get(applicant_id)
    if not applicant:
        return jsonify({"error": "Applicant not found"}), 404
    return jsonify({
        "id": applicant.id,
        "name": applicant.name,
        "languages": applicant.languages,
        "technologies": applicant.technologies,
        "flagship_project": applicant.flagship_project,
        "last_job": applicant.last_job,
        "education": applicant.education,
        "years_experience": applicant.years_experience,
        "resume_path": applicant.resume_path,
        "application_status": application.status,
        "application_score": application.score
    }), 200

@applicants_bp.route("/job/<int:job_id>/applicant/<int:applicant_id>", methods=["DELETE"])
def delete_application(job_id: int, applicant_id: int):
    application = Application.query.filter_by(job_id=job_id, applicant_id=applicant_id).first()
    if not application:
        return jsonify({"error": "Application not found"}), 404

    db.session.delete(application)
    db.session.commit()
    return jsonify({"message": "Application deleted",
                    "job_id": job_id,
                    "applicant_id": applicant_id
                    }), 200

@applicants_bp.route("/<int:id>", methods=["PUT"])
def update_applicant(id):
    applicant = Applicant.query.get(id)
    if not applicant:
        return jsonify({"error": "Applicant not found"}), 404

    data = request.get_json() or {}

    # Update fields if they exist in the model
    applicant.name = data.get("name", applicant.name)
    applicant.languages = data.get("languages", applicant.languages)
    applicant.technologies = data.get("technologies", applicant.technologies)
    applicant.flagship_project = data.get("flagship_project", applicant.flagship_project)
    applicant.last_job = data.get("last_job", applicant.last_job)
    applicant.education = data.get("education", applicant.education)
    applicant.years_experience = data.get("years_experience", applicant.years_experience)
    applicant.resume_path = data.get("resume_path", applicant.resume_path)

    db.session.commit()

    return jsonify({
        "id": applicant.id,
        "name": applicant.name,
        "languages": applicant.languages,
        "technologies": applicant.technologies,
        "flagship_project": applicant.flagship_project,
        "last_job": applicant.last_job,
        "education": applicant.education,
        "years_experience": applicant.years_experience,
        "resume_path": applicant.resume_path,
        "message": "Applicant updated successfully"
    }), 200




--- END: Backend/Routers/applicant_router.py ---

--- START: Backend/Routers/application_router.py ---
from flask import Blueprint, request, jsonify
from extensions import db
from Models.application import Application
from Models.job import Job
from Models.applicant import Applicant
from services import score_computing

apply_bp = Blueprint("apply", __name__, url_prefix="/apply")

@apply_bp.post("/<int:job_id>")
def apply_to_job(job_id):
    data = request.get_json() or {}
    user_id = data.get("applicant_id")
    if not user_id:
        return jsonify({"error": "applicant_id is required"}), 400

    job = Job.query.get(job_id)
    if not job:
        return jsonify({"error": "Job not found"}), 404

    applicant = Applicant.query.filter_by(user_id=user_id).first()
    if not applicant:
        return jsonify({"error": "Applicant not found"}), 404

    application = Application(
        job_id=job.id,
        applicant_id=applicant.id,
        status=data.get("status", "pending"),
    )
    db.session.add(application)
    db.session.flush()
    application.publisher_id = job.publisher_id
    application.score = score_computing.compute_application_score(applicant.id, job.id)
    db.session.commit()

    return jsonify({
        "id": application.id,
        "job_id": application.job_id,
        "applicant_id": application.applicant_id,
        "publisher_id": application.publisher_id,
        "status": application.status,
        "score": application.score
    }), 201

@apply_bp.route("/user/<int:user_id>", methods=["GET"])
def get_applications_for_applicant(user_id):
    applicant = Applicant.query.filter_by(user_id=user_id).first()
    if not applicant:
        return jsonify({"error": "Applicant not found"}), 404
    applications = Application.query.filter_by(applicant_id=applicant.id).all()
    if not applications:
        return jsonify({"error": "No applications found for this applicant"}), 404

    result = [
        {
            "id": app.id,
            "job_id": app.job_id,
            "description": Job.query.get(app.job_id).description if Job.query.get(app.job_id) else None,
            "job_title": Job.query.get(app.job_id).title if Job.query.get(app.job_id) else None,
            "publisher_id": app.publisher_id,
            "applicant_name": applicant.name,
            "status": app.status,
            "score": app.score,
        }
        for app in applications
    ]

    return jsonify(result), 200

@apply_bp.route("/publisher/<int:publisher_id>", methods=["GET"])
def get_applications_for_publisher(publisher_id):
    applications = Application.query.filter_by(publisher_id=publisher_id).all()
    if not applications:
        return jsonify({"error": "No applications found for this publisher"}), 404

    result = []
    for app in applications:
        job = Job.query.get(app.job_id)
        applicant = Applicant.query.get(app.applicant_id)
        result.append({
            "id": app.id,
            "job_id": app.job_id,
            "job_title": job.title if job else None,
            "job_description": job.description if job else None,
            "applicant_id": applicant.id if applicant else None,
            "applicant_name": applicant.name if applicant else None,
            "status": app.status,
            "score": app.score,
        })

    return jsonify(result), 200
--- END: Backend/Routers/application_router.py ---

--- START: Backend/Routers/auth_router.py ---
# Routers/auth_router.py
from flask import Blueprint, request, jsonify
from flask_jwt_extended import (
    create_access_token, create_refresh_token,
    jwt_required, get_jwt, get_jwt_identity
)
from extensions import db
from Models.user import User

auth_bp = Blueprint("auth", __name__, url_prefix="/auth")

@auth_bp.post("/register")
def register():
    data = request.get_json() or {}
    username = data.get("username")
    email = data.get("email")
    password = data.get("password")
    if not all([username, email, password]):
        return jsonify({"error": "username, email, password are required"}), 400

    if User.query.filter_by(email=email).first():
        return jsonify({"error": "Email already in use"}), 409

    is_admin = bool(data.get("is_admin", False))
    user = User(username=username, email=email, is_admin=is_admin)
    user.set_password(password)
    db.session.add(user)
    db.session.commit()
    applicant_id = None
    # If the user is not an admin, create an associated Applicant record
    if not is_admin:
        from Models.applicant import Applicant
        applicant = Applicant(user_id=user.id, name=username)
        db.session.add(applicant)
        db.session.commit()
        applicant_id = applicant.id

    claims = {"user_id": user.id, "is_admin": user.is_admin}
    access = create_access_token(identity=user.email, additional_claims=claims)
    refresh = create_refresh_token(identity=user.email, additional_claims=claims)
    return jsonify({
        "user": {"id": user.id, "username": user.username, "email": user.email, "is_admin": user.is_admin, "applicant_id": applicant_id},
        "access_token": access,
        "refresh_token": refresh
    }), 201

@auth_bp.post("/login")
def login():
    data = request.get_json() or {}
    email = data.get("email")
    password = data.get("password")
    if not all([email, password]):
        return jsonify({"error": "email and password are required"}), 400

    user = User.query.filter_by(email=email).first()
    if not user or not user.check_password(password):
        return jsonify({"error": "Invalid credentials"}), 401

    claims = {"user_id": user.id, "is_admin": user.is_admin}
    access = create_access_token(identity=user.email, additional_claims=claims)
    refresh = create_refresh_token(identity=user.email, additional_claims=claims)
    return jsonify({
        "user": {"id": user.id, "username": user.username, "email": user.email, "is_admin": user.is_admin, "applicant_id": user.applicants.id if user.applicants else None},
        "access_token": access, "refresh_token": refresh
    }), 200

@auth_bp.post("/refresh")
@jwt_required(refresh=True)
def refresh():
    claims = get_jwt()
    identity = claims.get("sub")
    new_access = create_access_token(identity=identity, additional_claims={
        "user_id": claims.get("user_id"),
        "is_admin": claims.get("is_admin", False)
    })
    return jsonify({"access_token": new_access}), 200

@auth_bp.get("/me")
@jwt_required()
def me():
    claims = get_jwt()
    user_id = claims.get("user_id")
    user = User.query.get(user_id)

    if not user:
        return jsonify({"error": "User not found"}), 404

    return jsonify({
        "email": claims.get("sub"),
        "user_id": user_id,
        "is_admin": claims.get("is_admin", False),
        "applicant_id": user.applicants.id if user.applicants else None
    }), 200

--- END: Backend/Routers/auth_router.py ---

--- START: Backend/Routers/job_router.py ---
from flask import Blueprint, request, jsonify

from Models import User
from extensions import db
from Models.job import Job
from flask_jwt_extended import jwt_required, get_jwt, get_jwt_identity
from services.auth_utils import admin_required

jobs_bp = Blueprint("jobs", __name__, url_prefix="/jobs")

@jobs_bp.get('/')
@jwt_required()
def list_jobs():
    claims = get_jwt()
    is_admin = claims.get("is_admin", False)
    user_id = claims.get("user_id")
    # Admin can see only the jobs he published,
    # regular users can see all jobs
    if is_admin:
        rows = Job.query.filter_by(publisher_id=user_id).all()
    else:
        rows = Job.query.all()
    return jsonify([
        {
            "id": j.id,
            "title": j.title,
            "employment_type": j.employment_type,
            "work_location": j.work_location,
            "description": j.description,
            "required_technologies": j.required_technologies,
            "required_experience": j.required_experience,
            "is_open": j.is_open
        } for j in rows
    ]), 200

@jobs_bp.get("/<int:id>")    #Get job by id
def get_by_id(id):
    job = Job.query.get(id)  # fetch by primary key
    if not job:
        return jsonify({"error": "The job doesn't exist"}), 404

    return jsonify({
        "id": job.id,
        "title": job.title,
        "employment_type": job.employment_type,
        "work_location": job.work_location,
        "description": job.description,
        "required_technologies": job.required_technologies,
        "required_experience": job.required_experience,
        "is_open": job.is_open
    }), 200


@jobs_bp.put("/<int:id>")
def update_job_by_id(id):
    job = Job.query.get(id)
    if not job:
        return jsonify({"error": "Job not found"}), 404

    data = request.get_json() or {}

    # Update fields if they exist in the model
    if "title" in data:
        job.title = data["title"]
    if "employment_type" in data:
        job.employment_type = data["employment_type"]
    if "work_location" in data:
        job.work_location = data["work_location"]
    if "description" in data:
        job.description = data["description"]
    if "required_technologies" in data:
        job.required_technologies = data["required_technologies"]
    if "required_experience" in data:
        job.required_experience = data["required_experience"]
    if "is_open" in data:
        job.is_open = bool(data["is_open"])

    db.session.commit()

    return jsonify({
        "id": job.id,
        "title": job.title,
        "employment_type": job.employment_type,
        "work_location": job.work_location,
        "description": job.description,
        "required_technologies": job.required_technologies,
        "required_experience": job.required_experience,
        "is_open": job.is_open,
        "message": "Job updated successfully"
    }), 200

@jobs_bp.route("/", methods=["POST"])
@jwt_required()
@admin_required
def create_job():
    data = request.get_json() or {}
    if isinstance(data, list):
        jobs = []
        for item in data:
            if not item.get("title"):
                return jsonify({"error": "Title is required"}), 400
            job = Job(**item)
            jobs.append(job)
        db.session.add_all(jobs)
        db.session.commit()
        return jsonify([{"id": j.id, "title": j.title} for j in jobs]), 201
    else:
        if not data.get("title"):
            return jsonify({"error": "Title is required"}), 400
        job = Job(**data)
        db.session.add(job)
        db.session.commit()
        return jsonify({"id": job.id, "title": job.title}), 201

@jobs_bp.delete("/<int:id>")
@jwt_required()
@admin_required
def delete_by_id(id):
    job = Job.query.get(id)  # fetch by primary key
    if not job:
        return jsonify({"error": "The job doesn't exist"}), 404
    db.session.delete(job)
    db.session.commit()
    return jsonify({"status": "Done", "message": f"Job {id} deleted!"}), 200

--- END: Backend/Routers/job_router.py ---

--- START: Backend/Routers/users_router.py ---
from flask import Blueprint, request, jsonify
from extensions import db
from Models.user import User

users_bp = Blueprint("users", __name__, url_prefix="/users")

@users_bp.route('/', methods=['GET'])
def list_users():
    rows = User.query.order_by(User.id.desc()).all()
    return jsonify([
        {
            "id": u.id,
            "username": u.username,
            "email": u.email,
            "is_admin": u.is_admin
        } for u in rows
    ]), 200

@users_bp.route('/<int:id>', methods=['GET'])    #Get user by id
def get_user_by_id(id):
    user = User.query.get(id)  # fetch by primary key
    if not user:
        return jsonify({"error": "The user doesn't exist"}), 404
    return jsonify({
        "id": user.id,
        "username": user.username,
        "email": user.email,
        "is_admin": user.is_admin
    }), 200

@users_bp.route('/<int:id>', methods=['PUT'])
def update_user_by_id(id):
    user = User.query.get(id)
    if not user:
        return jsonify({"error": "User not found"}), 404

    data = request.get_json() or {}

    # Update fields if they exist in the model
    if "username" in data:
        user.username = data["username"]
    if "email" in data:
        user.email = data["email"]
    if "is_admin" in data:
        if data["is_admin"] in [True, False]:
            user.is_admin = data["is_admin"]

    db.session.commit()

    return jsonify({
        "id": user.id,
        "username": user.username,
        "email": user.email,
        "is_admin": user.is_admin
    }), 200

@users_bp.route('/<int:id>', methods=['DELETE'])
def delete_user_by_id(id):
    user = User.query.get(id)
    if not user:
        return jsonify({"error": "User not found"}), 404

    db.session.delete(user)
    db.session.commit()

    return jsonify({"message": "User deleted successfully"}), 200

@users_bp.route('/', methods=['POST'])
def create_user():
    data = request.get_json() or {}

    if isinstance(data, list):
        users = []
        for item in data:
            if not all(key in item for key in ("username", "email")):
                return jsonify({"error": "Missing required fields"}), 400
            user = User(
                username=item["username"],
                email=item["email"],
                is_admin=item.get("is_admin", False),
                password_hash=item.get("password_hash", "default_hash")
            )
            db.session.add(user)
            users.append(user)
        db.session.commit()
        return jsonify([{
            "id": u.id,
            "username": u.username,
            "email": u.email,
            "is_admin": u.is_admin
        } for u in users]), 201
    else:
        if not all(key in data for key in ("username", "email")):
            return jsonify({"error": "Missing required fields"}), 400
        user = User(
            username=data["username"],
            email=data["email"],
            is_admin=data.get("is_admin", False),
            password_hash=data.get("password_hash", "default_hash")
        )
        db.session.add(user)
        db.session.commit()
        return jsonify({
            "id": user.id,
            "username": user.username,
            "email": user.email,
            "is_admin": user.is_admin
        }), 201


--- END: Backend/Routers/users_router.py ---

--- START: Backend/Models/__init__.py ---
from .job import Job
from .applicant import Applicant
from .application import Application
from .user import User

__all__ = ["Job", "Applicant", "Application", "User"]
--- END: Backend/Models/__init__.py ---

--- START: Backend/Models/applicant.py ---
# applicant table
from enum import unique

from extensions import db

class Applicant(db.Model):
    __tablename__ = "applicants"
    id = db.Column(db.Integer, primary_key=True)
    user_id = db.Column(db.Integer, db.ForeignKey("users.id"), unique=True , nullable=True, index=True)

    name = db.Column(db.String(200),nullable=False)
    languages = db.Column(db.Text)          # "Python, Bash, Go"
    technologies = db.Column(db.Text)       # "AWS, Docker, Kubernetes"
    flagship_project = db.Column(db.Text)
    last_job = db.Column(db.String(200))
    education = db.Column(db.Text)
    years_experience = db.Column(db.Integer)
    resume_path = db.Column(db.Text)        # CV file path

    applications = db.relationship("Application", back_populates="applicant", cascade="all, delete-orphan")
    user = db.relationship("User", back_populates="applicants")
--- END: Backend/Models/applicant.py ---

--- START: Backend/Models/application.py ---
from extensions import db

class Application(db.Model):
    __tablename__ = "applications"
    id = db.Column(db.Integer, primary_key=True)
    applicant_id = db.Column(db.Integer, db.ForeignKey("applicants.id"), nullable=False, index=True)
    job_id = db.Column(db.Integer, db.ForeignKey("jobs.id"), nullable=False, index=True)
    status = db.Column(db.String(50), default="pending")
    score = db.Column(db.Float)

    publisher_id = db.Column(db.Integer, db.ForeignKey("users.id"), nullable=True, index=True)

    applicant = db.relationship("Applicant", back_populates="applications")
    job = db.relationship("Job", back_populates="applications")
    publisher = db.relationship("User", back_populates="received_applications")
--- END: Backend/Models/application.py ---

--- START: Backend/Models/job.py ---
from extensions import db

class Job(db.Model):
    __tablename__ = "jobs"
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(200), nullable=False)
    employment_type = db.Column(db.String(50))      # Full/Partially
    work_location = db.Column(db.String(50))        # Home/Office/Hybrid
    description = db.Column(db.Text)
    required_technologies = db.Column(db.Text)      # "AWS, Docker, K8s"
    required_experience = db.Column(db.Integer)     # Experience in years
    is_open = db.Column(db.Boolean, default=True)
    publisher_id = db.Column(db.Integer, db.ForeignKey("users.id"), nullable=False, index=True)

    applications = db.relationship(
        "Application",
        back_populates="job",
        cascade="all, delete-orphan"
    )

    publisher = db.relationship("User", back_populates="published_jobs")
--- END: Backend/Models/job.py ---

--- START: Backend/Models/user.py ---
from extensions import db
from werkzeug.security import generate_password_hash, check_password_hash
#×˜×‘×œ×ª ××©×ª××©×™× ×œ××¢×¨×›×ª
class User(db.Model):
    __tablename__ = "users"
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(100), nullable=False)
    email = db.Column(db.String(255), unique=True, nullable=False)
    password_hash = db.Column(db.String(255), nullable=False)
    is_admin = db.Column(db.Boolean, default=False)

    applicants = db.relationship("Applicant", back_populates="user", uselist=False)

    published_jobs = db.relationship("Job", back_populates="publisher", cascade="all, delete-orphan")
    received_applications = db.relationship("Application", back_populates="publisher", cascade="all, delete-orphan")

    def set_password(self, password):
        self.password_hash = generate_password_hash(password)

    def check_password(self, password):
        return check_password_hash(self.password_hash, password)
--- END: Backend/Models/user.py ---
